import fs from 'fs';
import path from 'path';

const sidebars = {};
const docsPath = path.resolve(process.cwd(), 'docs');

const ignoreFolders = ['images', 'img', 'assets', '.DS_Store'];

if (fs.existsSync(docsPath)) {
  const topLevelFolders = fs.readdirSync(docsPath, { withFileTypes: true })
    .filter(dirent => dirent.isDirectory() && !ignoreFolders.includes(dirent.name));

  topLevelFolders.forEach(topFolder => {
    const topName = topFolder.name;
    const subDirPath = path.join(docsPath, topName);

    // è¯»å–äºŒçº§ç›®å½•å¹¶è¿‡æ»¤
    const subFolders = fs.readdirSync(subDirPath, { withFileTypes: true })
      .filter(dirent => dirent.isDirectory() && !ignoreFolders.includes(dirent.name));

    if (subFolders.length > 0) {
      // æœ‰äºŒçº§ç›®å½•æ—¶ï¼šç”Ÿæˆå®Œå…¨éš”ç¦»çš„ç‹¬ç«‹ä¾§è¾¹æ 
      subFolders.forEach(subFolder => {
        const subName = subFolder.name;
        sidebars[`${topName}_${subName}`] = [
          {
            type: 'autogenerated',
            dirName: `${topName}/${subName}`
          }
        ];
      });
    } else {
      // ğŸŒŸ ä¿®å¤çš„åœ°æ–¹åœ¨è¿™é‡Œï¼šæ²¡æœ‰äºŒçº§ç›®å½•æ—¶ï¼ŒID å¿…é¡»å¸¦ä¸Š Sidebar åç¼€ï¼
      sidebars[`${topName}Sidebar`] = [
        {
          type: 'autogenerated',
          dirName: topName
        }
      ];
    }
  });
}

export default sidebars;