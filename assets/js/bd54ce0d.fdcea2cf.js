"use strict";(globalThis.webpackChunkweihubeats_website=globalThis.webpackChunkweihubeats_website||[]).push([[4290],{71003(e,n,s){s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>a,frontMatter:()=>i,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"\u6570\u636e\u5e93/MySQL/MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b","title":"MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b","description":"\u80cc\u666f","source":"@site/docs/\u6570\u636e\u5e93/MySQL/MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b.md","sourceDirName":"\u6570\u636e\u5e93/MySQL","slug":"/\u6570\u636e\u5e93/MySQL/MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b","permalink":"/docs/\u6570\u636e\u5e93/MySQL/MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u6570\u636e\u5e93/MySQL/MySQL\u4ebf\u7ea7\u5927\u8868\u5982\u4f55\u53d8\u66f4\u5b57\u6bb5\u7c7b\u578b.md","tags":[],"version":"current","frontMatter":{},"sidebar":"MySQL","next":{"title":"MySQL\u5927\u8868\u5982\u4f55\u6dfb\u52a0\u7d22\u5f15","permalink":"/docs/\u6570\u636e\u5e93/MySQL/MySQL\u5927\u8868\u5982\u4f55\u6dfb\u52a0\u7d22\u5f15"}}');var r=s(74848),c=s(28453);const i={},d=void 0,t={},o=[{value:"\u80cc\u666f",id:"\u80cc\u666f",level:2},{value:"\u73af\u5883",id:"\u73af\u5883",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2},{value:"\u6a21\u62df\u64cd\u4f5c",id:"\u6a21\u62df\u64cd\u4f5c",level:2},{value:"Docker\u5b89\u88c5MySQL",id:"docker\u5b89\u88c5mysql",level:3},{value:"\u5b89\u88c5gh-ost",id:"\u5b89\u88c5gh-ost",level:2},{value:"\u6784\u5efa\u6d4b\u8bd5\u6570\u636e",id:"\u6784\u5efa\u6d4b\u8bd5\u6570\u636e",level:2},{value:"\u6267\u884c\u8fc1\u79fb",id:"\u6267\u884c\u8fc1\u79fb",level:2},{value:"\u73af\u5883\u6e05\u7406(\u53ef\u9009)",id:"\u73af\u5883\u6e05\u7406\u53ef\u9009",level:2},{value:"\u8fc1\u79fb\u901f\u5ea6\u592a\u6162",id:"\u8fc1\u79fb\u901f\u5ea6\u592a\u6162",level:2},{value:"\u5f02\u5e38\u60c5\u51b5\u5904\u7406",id:"\u5f02\u5e38\u60c5\u51b5\u5904\u7406",level:2},{value:"\u4e3b\u4ece\u5ef6\u8fdf\u8fc7\u5927\uff0c\u4ece\u5e93\u62a5\u8b66 \u5728\u4e3b\u5e93\u5199\u5165\u592a\u5feb\uff0c\u5355\u7ebf\u7a0b\u590d\u5236\u7684\u4ece\u5e93\u8ffd\u4e0d\u4e0a",id:"\u4e3b\u4ece\u5ef6\u8fdf\u8fc7\u5927\u4ece\u5e93\u62a5\u8b66-\u5728\u4e3b\u5e93\u5199\u5165\u592a\u5feb\u5355\u7ebf\u7a0b\u590d\u5236\u7684\u4ece\u5e93\u8ffd\u4e0d\u4e0a",level:3},{value:"\u78c1\u76d8\u7a7a\u95f4\u62a5\u8b66\uff1a \u8fc1\u79fb\u8dd1\u5230 80%\uff0c\u8fd0\u7ef4\u62a5\u8b66\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\uff08Disk Usage &gt; 90%\uff09\u3002 \u539f\u56e0\uff1a Binlog \u589e\u957f\u592a\u5feb\uff0c\u6216\u8005\u65b0\u65e7\u4e24\u5f20\u5927\u8868\u5e76\u5b58\uff088000\u4e07\u884c x 2\uff09\u5360\u6ee1\u4e86\u7a7a\u95f4",id:"\u78c1\u76d8\u7a7a\u95f4\u62a5\u8b66-\u8fc1\u79fb\u8dd1\u5230-80\u8fd0\u7ef4\u62a5\u8b66\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3disk-usage--90-\u539f\u56e0-binlog-\u589e\u957f\u592a\u5feb\u6216\u8005\u65b0\u65e7\u4e24\u5f20\u5927\u8868\u5e76\u5b588000\u4e07\u884c-x-2\u5360\u6ee1\u4e86\u7a7a\u95f4",level:3},{value:"Cut-over \u9636\u6bb5\u5207\u6362\u8d85\u65f6/\u5931\u8d25",id:"cut-over-\u9636\u6bb5\u5207\u6362\u8d85\u65f6\u5931\u8d25",level:2},{value:"\u5f7b\u5e95\u653e\u5f03\u8fc1\u79fb\uff08\u5982\u4f55\u6e05\u7406\u5783\u573e\uff09",id:"\u5f7b\u5e95\u653e\u5f03\u8fc1\u79fb\u5982\u4f55\u6e05\u7406\u5783\u573e",level:3}];function h(e){const n={code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\u80cc\u666f",children:"\u80cc\u666f"}),"\n",(0,r.jsx)(n.p,{children:"\u7ebf\u4e0a\u5343\u4e07\u5927\u8868\u9700\u8981\u53d8\u66f4\u8868\u5b57\u6bb5,\u6570\u636e\u91cf\u57288000w\u5de6\u53f3"}),"\n",(0,r.jsx)(n.h2,{id:"\u73af\u5883",children:"\u73af\u5883"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u5e93\uff1a MySQL8"}),"\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u91cf: 8000w"}),"\n",(0,r.jsxs)(n.li,{children:["\u8868\u540d",":user_order"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,r.jsxs)(n.p,{children:["\u8fc1\u79fb\u8fc7\u7a0b\u9700\u8981\u6ce8\u610f",(0,r.jsx)(n.code,{children:"DTS"}),"\u540c\u6b65\u5230\u4e0b\u6e38\u6570\u636e\u5e93\u7684\u517c\u5bb9\u6027\u95ee\u9898"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6bd4\u5982",(0,r.jsx)(n.code,{children:"SelectDB"}),"\u6216\u8005",(0,r.jsx)(n.code,{children:"ADB"}),"\u662f\u5426\u4f1a\u540c\u6b65\u53d8\u66f4\u8868\u7ed3\u6784\uff0cDTS\u662f\u5426\u4f1a\u65ad\u8fde"]}),"\n",(0,r.jsxs)(n.p,{children:["\u76ee\u524d\u9a8c\u8bc1\u662f",(0,r.jsx)(n.code,{children:"SelectDB"}),"\u548c",(0,r.jsx)(n.code,{children:"ADB"}),"\u9700\u8981\u624b\u52a8\u53d8\u66f4\u8868\u5b57\u6bb5\nDTS\u5982\u679c\u662f",(0,r.jsx)(n.code,{children:"TINNIT"}),"\u4fee\u6539\u4e3a",(0,r.jsx)(n.code,{children:"INT"})," DTS\u4e0d\u4f1a\u4e2d\u65ad"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6a21\u62df\u64cd\u4f5c",children:"\u6a21\u62df\u64cd\u4f5c"}),"\n",(0,r.jsx)(n.h3,{id:"docker\u5b89\u88c5mysql",children:"Docker\u5b89\u88c5MySQL"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u505c\u6b62\u5e76\u5220\u9664\u65e7\u5bb9\u5668\uff08\u5982\u679c\u6709\uff09\ndocker stop mysql-lab && docker rm mysql-lab\n\n# \u542f\u52a8\u65b0\u5bb9\u5668\uff08\u9002\u914d M1 \u82af\u7247\uff09\ndocker run --name mysql-lab \\\n  -e MYSQL_ROOT_PASSWORD=root \\\n  -p 3306:3306 \\\n  -d mysql:8.0 \\\n  --server-id=100 \\\n  --log-bin=mysql-bin \\\n  --binlog-format=ROW \\\n  --default-authentication-plugin=mysql_native_password\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5b89\u88c5\u5b8c\u6210\u540e\u53ef\u4ee5\u4f7f\u7528",(0,r.jsx)(n.code,{children:"docker"}),"\u81ea\u5e26\u5de5\u5177\u8fdb\u884c\u8fde\u63a5\u6570\u636e\u5e93\uff0c\u786e\u8ba4\u6570\u636e\u5e93\u5b89\u88c5\u6b63\u786e"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u4f7f\u7528 Docker \u5185\u7f6e\u5ba2\u6237\u7aef\u8fde\u63a5\ndocker exec -it mysql-lab mysql -uroot -proot\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5gh-ost",children:"\u5b89\u88c5gh-ost"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u5b89\u88c5"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew install gh-ost\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gh-ost --version\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6784\u5efa\u6d4b\u8bd5\u6570\u636e",children:"\u6784\u5efa\u6d4b\u8bd5\u6570\u636e"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u5efa\u8868"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE DATABASE IF NOT EXISTS gh_test;\nUSE gh_test;\n\n-- \u539f\u59cb\u8868\u7ed3\u6784\nCREATE TABLE user_order (\n    id BIGINT AUTO_INCREMENT PRIMARY KEY,\n    order_no VARCHAR(64) NOT NULL,\n    biz_type TINYINT NOT NULL COMMENT '\u4e1a\u52a1\u7c7b\u578b', -- \u8fd9\u91cc\u662f\u6211\u4eec\u4e3b\u8981\u4fee\u6539\u7684\u5b57\u6bb5\n    create_time DATETIME DEFAULT CURRENT_TIMESTAMP\n) ENGINE=InnoDB;\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u751f\u6210\u6d4b\u8bd5\u6570\u636e"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DELIMITER //\nCREATE PROCEDURE generate_data()\nBEGIN\n  DECLARE i INT DEFAULT 0;\n  -- \u5faa\u73af\u63d2\u5165 500,000 \u6761\u6570\u636e\n  WHILE i < 500000 DO\n    INSERT INTO user_order (order_no, biz_type) \n    VALUES (UUID(), FLOOR(RAND() * 100)); -- biz_type \u968f\u673a\u751f\u6210 0-99\n    SET i = i + 1;\n  END WHILE;\nEND;\n//\nDELIMITER ;\n\n-- \u6267\u884c\u5b58\u50a8\u8fc7\u7a0b\uff08\u53ef\u80fd\u9700\u8981 30\u79d2 - 1\u5206\u949f\uff09\nCALL generate_data();\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u5b58\u50a8\u8fc7\u7a0b\u88ab\u7981\u7528\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u65e9\u6570\u636e\u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u79cd\u5b50\u6570\u636e\u63d2\u5165\nINSERT INTO user_order (order_no, biz_type) VALUES  (UUID(), 10), (UUID(), 20), (UUID(), 30), (UUID(), 40), (UUID(), 50);\n\n-- \u7b1b\u5361\u5c14\u79ef\u63d2\u516550w\u6570\u636e\nINSERT INTO user_order (order_no, biz_type) SELECT      UUID(),FLOOR(RAND() * 100)    FROM     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t1,     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t2,     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t3,     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t4,     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t5,     (SELECT 0 AS n UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t6 LIMIT 500000;\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u6d4b\u8bd5\u6570\u636e\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u786e\u8ba4\u8f93\u51fa 500000\nSELECT count(*) FROM user_order; \n-- \u786e\u8ba4\u6570\u636e\u5728 tinyint \u8303\u56f4\u5185\nSELECT min(biz_type), max(biz_type) FROM user_order; \n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6267\u884c\u8fc1\u79fb",children:"\u6267\u884c\u8fc1\u79fb"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u521b\u5efa\u63a7\u5236\u6587\u4ef6"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"touch /tmp/ghost.postpone.flag\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u6267\u884cgh-ost\u547d\u4ee4"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'gh-ost \\\n--max-load=Threads_running=25 \\\n--critical-load=Threads_running=50 \\\n--chunk-size=3000 \\\n--max-lag-millis=1500 \\\n--host=127.0.0.1 \\\n--port=3306 \\\n--user="root" \\\n--password="root" \\\n--database="gh_test" \\\n--table="user_order" \\\n--alter="MODIFY COLUMN biz_type INT NOT NULL DEFAULT 0 COMMENT \'\u4e1a\u52a1\u7c7b\u578b\'" \\\n--allow-on-master \\\n--concurrent-rowcount \\\n--cut-over=default \\\n--exact-rowcount \\\n--panic-flag-file=/tmp/ghost.panic.flag \\\n--postpone-cut-over-flag-file=/tmp/ghost.postpone.flag \\\n--execute\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u7ec8\u7aef\u663e\u793a\u8fdb\u5ea6"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Copy: 250000/500000 50.0% ..."}),"\n",(0,r.jsx)(n.li,{children:"\u5982\u679c\u60f3\u6682\u505c\uff0c\u6253\u5f00\u53e6\u4e00\u4e2a\u7ec8\u7aef\uff1aecho throttle | nc -U /tmp/gh-ost.gh_test.user_order.sock"}),"\n",(0,r.jsx)(n.li,{children:"\u6700\u540e\u5b83\u4f1a\u505c\u5728\uff1aCopy: 500000/500000 100.0% \u5e76\u4e14\u72b6\u6001\u663e\u793a Postponing cut-over\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6b64\u65f6\uff0c\u6570\u636e\u5df2\u7ecf\u540c\u6b65\u5230\u4e86\u5f71\u5b50\u8868\uff08\u9690\u5f62\u7684\u65b0\u8868\uff09\uff0c\u4e14\u6b63\u5728\u5b9e\u65f6\u540c\u6b65\u589e\u91cf\u6570\u636e"}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"\u6a21\u62df\u751f\u4ea7\u73af\u5883\u7684\u201c\u589e\u91cf\u5199\u5165\u201d"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- \u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\u8fde\u63a5 MySQL\nINSERT INTO user_order (order_no, biz_type) VALUES ('NEW_DATA_TEST', 120);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:s(48632).A+"",width:"1280",height:"574"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:"\u6267\u884c\u5207\u6362 (Cut-over)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \u5728\u53e6\u4e00\u4e2a\u7ec8\u7aef\u6267\u884c\nrm /tmp/ghost.postpone.flag\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u56de\u5230\u8fd0\u884c ",(0,r.jsx)(n.code,{children:"gh-ost"})," \u7684\u7ec8\u7aef\uff0c\u53d1\u73b0\u8f93\u51fa ",(0,r.jsx)(n.code,{children:"Done"})," \u5e76\u9000\u51fa"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:s(34725).A+"",width:"2354",height:"1062"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5b57\u6bb5\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DESC user_order;\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:s(32580).A+"",width:"1262",height:"360"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6570\u636e\u91cf\u9a8c\u8bc1"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"alt text",src:s(87216).A+"",width:"1260",height:"594"})}),"\n",(0,r.jsx)(n.h2,{id:"\u73af\u5883\u6e05\u7406\u53ef\u9009",children:"\u73af\u5883\u6e05\u7406(\u53ef\u9009)"}),"\n",(0,r.jsx)(n.p,{children:"\u9a8c\u8bc1\u5b8c\u6210\u540e\u5982\u679c\u6211\u4eec\u60f3\u8981\u6e05\u7406\u73af\u5883"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker stop mysql-lab\ndocker rm mysql-lab\nrm /tmp/gh-ost.*.sock\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8fc1\u79fb\u901f\u5ea6\u592a\u6162",children:"\u8fc1\u79fb\u901f\u5ea6\u592a\u6162"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u7ebf\u4e0a\u8d44\u6e90\u6587\u6863\uff0c\u8868\u6570\u636e\u540c\u6b65\u592a\u6162\uff0c\u53ef\u4ee5\u52a8\u6001\u8c03\u6574\u8fc1\u79fb\u6279\u6b21"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u589e\u5927 chunk-size (\u6bcf\u6b21\u62f7\u8d1d\u7684\u884c\u6570)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u5c06\u6279\u6b21\u5927\u5c0f\u4ece 1000 \u8c03\u6574\u4e3a 2000\necho chunk-size=2000 | nc -U /tmp/gh-ost.gh_test.user_order.sock\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u653e\u5bbd max-lag-millis (\u5ef6\u8fdf\u5bb9\u5fcd\u5ea6)"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u5c06\u6700\u5927\u5141\u8bb8\u5ef6\u8fdf\u8c03\u6574\u4e3a 3000\u6beb\u79d2 (3\u79d2)\necho max-lag-millis=3000 | nc -U /tmp/gh-ost.gh_test.user_order.sock\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u5f02\u5e38\u60c5\u51b5\u5904\u7406",children:"\u5f02\u5e38\u60c5\u51b5\u5904\u7406"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e00\u822c\u542f\u52a8\u4f1a\u6253\u5370\u51fa",(0,r.jsx)(n.code,{children:"gh-ost"}),"\u8fd0\u884c\u65f6\u521b\u5efa\u7684",(0,r.jsx)(n.code,{children:"socket"}),"\u6587\u4ef6"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# Serving on unix socket: /tmp/gh-ost.gh_test.user_order.sock\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u91cc\u53ef\u4ee5\u770b\u5230\u76ee\u5f55\u5728",(0,r.jsx)(n.code,{children:"/tmp/gh-ost.gh_test.user_order.sock"})]}),"\n",(0,r.jsxs)(n.h3,{id:"\u4e3b\u4ece\u5ef6\u8fdf\u8fc7\u5927\u4ece\u5e93\u62a5\u8b66-\u5728\u4e3b\u5e93\u5199\u5165\u592a\u5feb\u5355\u7ebf\u7a0b\u590d\u5236\u7684\u4ece\u5e93\u8ffd\u4e0d\u4e0a",children:["\u4e3b\u4ece\u5ef6\u8fdf\u8fc7\u5927\uff0c\u4ece\u5e93\u62a5\u8b66",":gh-ost"," \u5728\u4e3b\u5e93\u5199\u5165\u592a\u5feb\uff0c\u5355\u7ebf\u7a0b\u590d\u5236\u7684\u4ece\u5e93\u8ffd\u4e0d\u4e0a"]}),"\n",(0,r.jsx)(n.p,{children:"gh-ost \u9ed8\u8ba4\u4f1a\u81ea\u52a8\u68c0\u6d4b\u4ece\u5e93\u5ef6\u8fdf\uff08--max-lag-millis\uff09\uff0c\u5982\u679c\u5b83\u6ca1\u751f\u6548\uff0c\u624b\u52a8\u901a\u8fc7 Socket \u8c03\u5927\u68c0\u6d4b\u7075\u654f\u5ea6\uff0c\u6216\u8005\u6682\u505c\u4e00\u4e0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo throttle | nc -U /tmp/gh-ost.gh_test.user_order.sock\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5f85\u6570\u636e\u5e93\u7a33\u5b9a\u540e\u6062\u590d\u540c\u6b65"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"echo no-throttle | nc -U /tmp/gh-ost.gh_test.user_order.sock\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u78c1\u76d8\u7a7a\u95f4\u62a5\u8b66-\u8fc1\u79fb\u8dd1\u5230-80\u8fd0\u7ef4\u62a5\u8b66\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3disk-usage--90-\u539f\u56e0-binlog-\u589e\u957f\u592a\u5feb\u6216\u8005\u65b0\u65e7\u4e24\u5f20\u5927\u8868\u5e76\u5b588000\u4e07\u884c-x-2\u5360\u6ee1\u4e86\u7a7a\u95f4",children:"\u78c1\u76d8\u7a7a\u95f4\u62a5\u8b66\uff1a \u8fc1\u79fb\u8dd1\u5230 80%\uff0c\u8fd0\u7ef4\u62a5\u8b66\u78c1\u76d8\u7a7a\u95f4\u4e0d\u8db3\uff08Disk Usage > 90%\uff09\u3002 \u539f\u56e0\uff1a Binlog \u589e\u957f\u592a\u5feb\uff0c\u6216\u8005\u65b0\u65e7\u4e24\u5f20\u5927\u8868\u5e76\u5b58\uff088000\u4e07\u884c x 2\uff09\u5360\u6ee1\u4e86\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.h2,{id:"cut-over-\u9636\u6bb5\u5207\u6362\u8d85\u65f6\u5931\u8d25",children:"Cut-over \u9636\u6bb5\u5207\u6362\u8d85\u65f6/\u5931\u8d25"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u73b0\u8c61\uff1a \u6570\u636e\u540c\u6b65\u5230\u4e86 100%\uff0c\u4f60\u5220\u9664\u4e86 postpone \u6587\u4ef6\u5f00\u59cb\u5207\u6362\uff0c\u4f46 gh-ost \u62a5\u9519\u8d85\u65f6\uff0c\u6216\u8005\u4e00\u76f4\u5728\u91cd\u8bd5\u3002 \u9519\u8bef\u65e5\u5fd7\u53ef\u80fd\u5305\u542b\uff1aError: ... lock wait timeout exceeded ..."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u539f\u56e0\uff1a \u5207\u6362\u8868\u540d\u9700\u8981\u83b7\u53d6\u539f\u8868\uff08user_order\uff09\u7684\u5143\u6570\u636e\u9501 (Metadata Lock)\u3002\u5982\u679c\u6b64\u65f6\u6709\u4e00\u4e2a\u957f\u4e8b\u52a1\uff08\u6bd4\u5982\u6709\u4eba\u5728\u8dd1\u62a5\u8868 SQL\uff09\u5360\u7528\u4e86\u539f\u8868\u7684\u8bfb\u9501\uff0cgh-ost \u5c31\u62a2\u4e0d\u5230\u9501\uff0c\u65e0\u6cd5\u91cd\u547d\u540d"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u6b63\u5728\u8fd0\u884c\u7684\u957f\u4e8b\u52a1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SHOW PROCESSLIST;\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u627e\u90a3\u4e9b Command \u662f Query \u4e14 Time \u5f88\u5927\u7684\u8fde\u63a5\uff0c\u4e14\u6b63\u5728\u64cd\u4f5c user_order \u8868\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u89e3\u51b3\u65b9\u6848\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\uff08\u63a8\u8350\uff09\uff1a\u7b49\u5f85\u8be5 SQL \u6267\u884c\u5b8c\u3002gh-ost \u4f1a\u4e0d\u65ad\u91cd\u8bd5"}),"\n",(0,r.jsx)(n.li,{children:"\uff08\u66b4\u529b\uff0c\u4e0d\u63a8\u8350\uff09\uff1a\u6740\u6389\u90a3\u4e2a\u963b\u585e\u7684\u4e1a\u52a1 SQL \u8fde\u63a5"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"\u5f7b\u5e95\u653e\u5f03\u8fc1\u79fb\u5982\u4f55\u6e05\u7406\u5783\u573e",children:"\u5f7b\u5e95\u653e\u5f03\u8fc1\u79fb\uff08\u5982\u4f55\u6e05\u7406\u5783\u573e\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u8fc1\u79fb\u4e86\u4e00\u534a\uff0c\u53d1\u73b0\u5b57\u6bb5\u52a0\u9519\u4e86\uff0c\u6216\u8005\u4e0d\u60f3\u8fc1\u4e86\u3002\u5982\u4f55\u628a\u73af\u5883\u6062\u590d\u539f\u72b6"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u7ec8\u6b62\u8fdb\u7a0b: \u5728\u8fd0\u884c gh-ost \u7684\u7ec8\u7aef\u6309 Ctrl+C\uff0c\u6216\u8005\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"kill"})," \u547d\u4ee4\u6740\u6389\u8fdb\u7a0b\u3002 \u6216\u8005\u4f7f\u7528 Panic \u6587\u4ef6\uff1a",(0,r.jsx)(n.code,{children:"touch /tmp/ghost.panic.flag"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u6e05\u7406\u6b8b\u7559\u8868:",(0,r.jsx)(n.code,{children:"gh-ost"}),"\u6ca1\u8fc1\u79fb\u5b8c\u6210\u4e3b\u8981\u662f\u6709\u4e00\u5f20\u5f71\u5b50\u8868:",(0,r.jsx)(n.code,{children:"_user_order_gho"}),"\uff08\u5f71\u5b50\u8868\uff09"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"DROP TABLE IF EXISTS _user_order_gho;\n"})})]})}function a(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},87216(e,n,s){s.d(n,{A:()=>l});const l=s.p+"assets/images/gh_ost_count-41d07cc300b64ee7da9cdbc385593ecf.png"},32580(e,n,s){s.d(n,{A:()=>l});const l=s.p+"assets/images/gh_ost_create_table-fcad5d6e8106321fbc3596eda0cd283f.png"},34725(e,n,s){s.d(n,{A:()=>l});const l=s.p+"assets/images/gh_ost_done-7e551f8c47453e6ab53e88aea1e419c7.png"},48632(e,n,s){s.d(n,{A:()=>l});const l=s.p+"assets/images/user_order_insert-2a85f0307c01e33c21382210beb2f728.png"},28453(e,n,s){s.d(n,{R:()=>i,x:()=>d});var l=s(96540);const r={},c=l.createContext(r);function i(e){const n=l.useContext(c);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);