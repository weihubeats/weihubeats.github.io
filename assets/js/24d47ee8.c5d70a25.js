"use strict";(globalThis.webpackChunkweihubeats_website=globalThis.webpackChunkweihubeats_website||[]).push([[1778],{13251(e,n,r){r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>s,default:()=>k,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528","title":"Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528","description":"\u914d\u7f6e","source":"@site/docs/MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528.md","sourceDirName":"MQ/Kafka/\u6700\u4f73\u5b9e\u8df5","slug":"/MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528","permalink":"/docs/MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/Spring Boot kafka\u6d88\u606f\u751f\u4ea7\u6d88\u8d39\u53ca\u6b7b\u4fe1\u961f\u5217\u4f7f\u7528.md","tags":[],"version":"current","lastUpdatedAt":1768562844000,"frontMatter":{},"sidebar":"Kafka","previous":{"title":"Kafka dashboard\u6280\u672f\u9009\u578b\u53ca\u5b9e\u6218Know Streaming","permalink":"/docs/MQ/Kafka/dashboard/Kafka dashboard\u6280\u672f\u9009\u578b\u53ca\u5b9e\u6218Know Streaming"},"next":{"title":"kafka\u6027\u80fd\u8c03\u4f18\u6700\u4f73\u5b9e\u8df5","permalink":"/docs/MQ/Kafka/\u6700\u4f73\u5b9e\u8df5/kafka\u6027\u80fd\u8c03\u4f18\u6700\u4f73\u5b9e\u8df5"}}');var t=r(74848),o=r(28453);const i={},s=void 0,p={},l=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:2}];function c(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spring:\n  kafka:\n    bootstrap-servers: localhost:9092\n    \n    # --- \u751f\u4ea7\u8005\u914d\u7f6e ---\n    producer:\n      # Key \u4f9d\u7136\u4f7f\u7528 String\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      # Value \u4f7f\u7528 Spring \u63d0\u4f9b\u7684 JsonSerializer\n      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer\n      properties:\n        # (\u53ef\u9009) \u5982\u679c\u4e0d\u60f3\u5728\u6d88\u606f\u5934\u4e2d\u643a\u5e26\u7c7b\u4fe1\u606f\uff0c\u53ef\u4ee5\u5173\u95ed\n        spring.json.add.type.headers: true \n\n    # --- \u6d88\u8d39\u8005\u914d\u7f6e ---\n    consumer:\n      group-id: json-group\n      # Key \u4f7f\u7528 String\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      # \u3010\u5173\u952e\u3011Value \u4f7f\u7528 ErrorHandlingDeserializer\uff0c\u9632\u6b62\u574f\u6570\u636e\u5361\u6b7b\n      value-deserializer: org.springframework.kafka.support.serializer.ErrorHandlingDeserializer\n      properties:\n        # \u6307\u5b9a\u88ab ErrorHandlingDeserializer \u59d4\u6258\u7684\u771f\u5b9e\u53cd\u5e8f\u5217\u5316\u5668\n        spring.deserializer.value.delegate.class: org.springframework.kafka.support.serializer.JsonDeserializer\n        \n        # \u3010\u5b89\u5168\u8bbe\u7f6e\u3011\u4fe1\u4efb\u7684\u5305\u8def\u5f84\u3002\u5982\u679c\u4f60\u7684 Producer \u548c Consumer \u5305\u540d\u4e0d\u540c\uff0c\u5efa\u8bae\u8bbe\u4e3a '*'\n        spring.json.trusted.packages: \"*\"\n        \n        # \u5f53\u53cd\u5e8f\u5217\u5316\u540e\u7684\u5bf9\u8c61\u6ca1\u6709\u67d0\u4e2a\u5b57\u6bb5\u65f6\uff0c\u662f\u5426\u62a5\u9519\uff08false\u8868\u793a\u5ffd\u7565\u672a\u77e5\u5b57\u6bb5\uff09\n        spring.json.use.type.headers: false\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u751f\u4ea7\u8005\u4ee3\u7801 (\u53d1\u9001\u5bf9\u8c61)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.kafka.core.KafkaTemplate;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class JsonProducerService {\n\n    @Autowired\n    private KafkaTemplate<String, Object> kafkaTemplate;\n\n    public void sendUserEvent(UserEvent event) {\n        // \u76f4\u63a5\u53d1\u9001\u5bf9\u8c61\uff0cSpring \u4f1a\u6839\u636e\u914d\u7f6e\u81ea\u52a8\u5c06\u5176\u5e8f\u5217\u5316\u4e3a JSON\n        kafkaTemplate.send("user-event-topic", event.getUserId(), event);\n        System.out.println("\u5df2\u53d1\u9001\u7528\u6237\u4e8b\u4ef6: " + event);\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u6d88\u8d39\u8005\u4ee3\u7801 (\u63a5\u6536\u5bf9\u8c61 + \u6b7b\u4fe1\u961f\u5217)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'import org.springframework.kafka.annotation.DltHandler;\nimport org.springframework.kafka.annotation.KafkaListener;\nimport org.springframework.kafka.annotation.RetryableTopic;\nimport org.springframework.kafka.support.KafkaHeaders;\nimport org.springframework.messaging.handler.annotation.Header;\nimport org.springframework.retry.annotation.Backoff;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class JsonConsumerService {\n\n    /**\n     * \u6b63\u5e38\u6d88\u8d39\u903b\u8f91\n     * Spring \u4f1a\u81ea\u52a8\u5c06 JSON \u53cd\u5e8f\u5217\u5316\u4e3a UserEvent \u5bf9\u8c61\n     */\n    @RetryableTopic(attempts = "3", backoff = @Backoff(delay = 1000))\n    @KafkaListener(topics = "user-event-topic", groupId = "json-group")\n    public void consumeUserEvent(UserEvent event) {\n        System.out.println("\u63a5\u6536\u5230\u5bf9\u8c61: " + event.toString());\n\n        // \u6a21\u62df\u4e1a\u52a1\u5f02\u5e38\n        if ("ERROR_USER".equals(event.getUserId())) {\n            throw new RuntimeException("\u6a21\u62df\u4e1a\u52a1\u5904\u7406\u5931\u8d25");\n        }\n    }\n\n    /**\n     * \u6b7b\u4fe1\u961f\u5217 (DLQ) \u5904\u7406\u903b\u8f91\n     * \u5f53\u91cd\u8bd5 3 \u6b21\u4f9d\u7136\u5931\u8d25\uff0c\u6216\u8005\u53cd\u5e8f\u5217\u5316\u5f7b\u5e95\u5931\u8d25\u65f6\uff0c\u8fdb\u5165\u8fd9\u91cc\n     */\n    @DltHandler\n    public void handleDlt(UserEvent event, @Header(KafkaHeaders.RECEIVED_TOPIC) String topic) {\n        // \u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u62ff\u5230\u5bf9\u8c61\uff0c\u5b58\u5e93\u6216\u544a\u8b66\n        System.err.println("\u5bf9\u8c61\u8fdb\u5165\u6b7b\u4fe1\u961f\u5217: " + event);\n        System.err.println("\u6765\u6e90 Topic: " + topic);\n    }\n}\n'})})]})}function k(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453(e,n,r){r.d(n,{R:()=>i,x:()=>s});var a=r(96540);const t={},o=a.createContext(t);function i(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);