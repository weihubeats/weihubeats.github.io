"use strict";(self.webpackChunkweihubeats_website=self.webpackChunkweihubeats_website||[]).push([[9147],{588:(e,r,a)=>{a.r(r),a.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898","title":"RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898","description":"\u80cc\u666f","source":"@site/docs/MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898.md","sourceDirName":"MQ/RocketMQ/\u95ee\u9898\u6392\u67e5","slug":"/MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898","permalink":"/docs/MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/RocketMQ\u4e0d\u80fd\u81ea\u52a8\u9009\u4e3emaster\u95ee\u9898.md","tags":[],"version":"current","frontMatter":{},"sidebar":"RocketMQ","previous":{"title":"\u914d\u7f6e\u6a21\u677f","permalink":"/docs/MQ/RocketMQ/\u8fd0\u7ef4/\u914d\u7f6e\u6a21\u677f"},"next":{"title":"\u8bb0\u4e00\u6b21\u7ebf\u7a0b\u6c60\u4f7f\u7528\u4e0d\u5f53\u5bfc\u81f4\u89e6\u53d1\u6b7b\u9501\u5bfc\u81f4RocketMQ\u6d88\u8d39\u505c\u6ede","permalink":"/docs/MQ/RocketMQ/\u95ee\u9898\u6392\u67e5/\u8bb0\u4e00\u6b21\u7ebf\u7a0b\u6c60\u4f7f\u7528\u4e0d\u5f53\u5bfc\u81f4\u89e6\u53d1\u6b7b\u9501\u5bfc\u81f4RocketMQ\u6d88\u8d39\u505c\u6ede"}}');var n=a(4848),o=a(8453);const c={},s=void 0,l={},i=[{value:"\u80cc\u666f",id:"\u80cc\u666f",level:2},{value:"\u62a5\u9519",id:"\u62a5\u9519",level:2},{value:"\u4ea7\u751f\u539f\u56e0",id:"\u4ea7\u751f\u539f\u56e0",level:2},{value:"\u89e3\u51b3\u65b9\u5f0f",id:"\u89e3\u51b3\u65b9\u5f0f",level:2},{value:"\u5907\u6ce8",id:"\u5907\u6ce8",level:2}];function d(e){const r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"\u80cc\u666f",children:"\u80cc\u666f"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"RocketMQ\u7248\u672c: 5.1.0"}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.p,{children:"\u90e8\u7f72\u65b9\u5f0f"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"alt text",src:a(9194).A+"",width:"1640",height:"1231"})}),"\n",(0,n.jsx)(r.h2,{id:"\u62a5\u9519",children:"\u62a5\u9519"}),"\n",(0,n.jsx)(r.p,{children:"\u9996\u9009\u901a\u8fc7\u6267\u884c\u547d\u4ee4\u67e5\u770b\u540c\u6b65\u4fe1\u606f"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"sh bin/mqadmin getSyncStateSet -a 127.0.0.1:9878 -b broker-a\n"})}),"\n",(0,n.jsx)(r.p,{children:(0,n.jsx)(r.img,{alt:"alt text",src:a(7324).A+"",width:"954",height:"428"})}),"\n",(0,n.jsxs)(r.p,{children:["\u53d1\u73b0\u6709\u51e0\u4e2abroker\u5904\u4e8e",(0,n.jsx)(r.code,{children:"NotInSyncReplica"}),"\u72b6\u6001"]}),"\n",(0,n.jsxs)(r.p,{children:["\u67e5\u770b",(0,n.jsx)(r.code,{children:"broker"})," log\u4fe1\u606f"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:"tail -f ~/logs/rocketmqlogs/brokerLogDir_IS_UNDEFINED/broker.log\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u53d1\u73b0\u5982\u4e0b\u62a5\u9519"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"2023-03-15 16:59:06 WARN ReplicasManager_ExecutorService_1 - Failed to start replicasManager, retry times:35, current state:FIRST_TIME_SYNC_CONTROLLER_METADATA_DONE, try it again\n2023-03-15 16:59:06 ERROR ReplicasManager_ExecutorService_1 - Failed to register broker to controller\norg.apache.rocketmq.client.exception.MQBrokerException: CODE: 2012  DESC: The broker has not master, and this new registered broker can't not be elected as master\nFor more information, please visit the url, https://rocketmq.apache.org/docs/bestPractice/06FAQ\n        at org.apache.rocketmq.broker.out.BrokerOuterAPI.registerBrokerToController(BrokerOuterAPI.java:1183)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.registerBrokerToController(ReplicasManager.java:302)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.startBasicService(ReplicasManager.java:151)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.lambda$start$0(ReplicasManager.java:133)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n        at java.lang.Thread.run(Thread.java:750)\n2023-03-15 16:59:11 WARN ReplicasManager_ExecutorService_1 - Failed to start replicasManager, retry times:36, current state:FIRST_TIME_SYNC_CONTROLLER_METADATA_DONE, try it again\n2023-03-15 16:59:11 ERROR ReplicasManager_ExecutorService_1 - Failed to register broker to controller\norg.apache.rocketmq.client.exception.MQBrokerException: CODE: 2012  DESC: The broker has not master, and this new registered broker can't not be elected as master\nFor more information, please visit the url, https://rocketmq.apache.org/docs/bestPractice/06FAQ\n        at org.apache.rocketmq.broker.out.BrokerOuterAPI.registerBrokerToController(BrokerOuterAPI.java:1183)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.registerBrokerToController(ReplicasManager.java:302)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.startBasicService(ReplicasManager.java:151)\n        at org.apache.rocketmq.broker.controller.ReplicasManager.lambda$start$0(ReplicasManager.java:133)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n        at java.lang.Thread.run(Thread.java:750)\n2023-03-15 16:59:14 INFO ReplicasManager_ScheduledService_2 - Update controller leader address to x.x.x.1:9878\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u6838\u5fc3\u9519\u8bef:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:"The broker has not master, and this new registered broker can't not be elected as master\n"})}),"\n",(0,n.jsx)(r.h2,{id:"\u4ea7\u751f\u539f\u56e0",children:"\u4ea7\u751f\u539f\u56e0"}),"\n",(0,n.jsxs)(r.p,{children:["\u670d\u52a1\u5668\u90e8\u7f72\u4e86\u4e24\u4e2a",(0,n.jsx)(r.code,{children:"broker"}),"\uff0c\u7531\u4e8e\u6709\u95ee\u9898\uff0c\u60f3\u8981\u672c\u5730debug\uff0c\u4f7f\u7528\u672c\u5730\u65b9\u5f0f\u542f\u52a8\u4e86\u4e00\u4e2a",(0,n.jsx)(r.code,{children:"broker"}),"\u5e76\u88ab\u9009\u4e3e\u4e3amaster\u3002"]}),"\n",(0,n.jsxs)(r.p,{children:["\u7136\u540e\u53d1\u9001\u6d88\u606f\u5230\u672c\u5730",(0,n.jsx)(r.code,{children:"master"})," broker\n\u4e4b\u540e\u4e0b\u7ebf\u672c\u5730",(0,n.jsx)(r.code,{children:"broker"}),"\uff0c\u670d\u52a1\u5668\u4e0a\u7684\u4e24\u4e2a",(0,n.jsx)(r.code,{children:"broker"}),"\u7b97\u65b0\u52a0\u5165\u7684",(0,n.jsx)(r.code,{children:"broker"}),"\uff0c\u6240\u4ee5\u4e0d\u80fd\u9009\u4e3e\u4e3a",(0,n.jsx)(r.code,{children:"master"}),"\n\u63d0\u793a",(0,n.jsx)(r.code,{children:"and this new registered broker can't not be elected as master"})]}),"\n",(0,n.jsx)(r.h2,{id:"\u89e3\u51b3\u65b9\u5f0f",children:"\u89e3\u51b3\u65b9\u5f0f"}),"\n",(0,n.jsxs)(r.ol,{children:["\n",(0,n.jsxs)(r.li,{children:["\u6700\u7b80\u5355\u7684\u65b9\u5f0f\nNameserve\u914d\u7f6e\u65b0\u589e\n",(0,n.jsx)(r.code,{children:"enableElectUncleanMaster = true"}),",\u8868\u793a\u5141\u8bb8\u65b0\u52a0\u5165\u7684broker\u9009\u4e3e\u4e3amaster"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"\u6ce8\u610f\u5f00\u542f\u8fd9\u4e2a\u914d\u7f6e\u53ef\u80fd\u4f1a\u4e22\u5931\u6d88\u606f\uff0c\u5df2\u7ecf\u7a33\u5b9a\u5141\u8bb8\u7684\u96c6\u7fa4\u4e0d\u8981\u5f00\u542f\u8be5\u914d\u7f6e"}),"\n"]}),"\n",(0,n.jsx)(r.p,{children:"\u5982\u679c\u662f\u65b0\u5efa\u7684\u96c6\u7fa4\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u65b9\u5f0f\u6062\u590d\u96c6\u7fa4\uff0c\u7136\u540e\u518d\u5220\u9664\u8be5\u914d\u7f6e"}),"\n",(0,n.jsxs)(r.ol,{start:"2",children:["\n",(0,n.jsx)(r.li,{children:"\u5220\u9664\u5143\u6570\u636e\u64cd\u4f5c"}),"\n",(0,n.jsx)(r.li,{children:"\u4e0b\u7ebf\u4e3b\u5907Broker"}),"\n",(0,n.jsxs)(r.li,{children:["\u5229\u7528",(0,n.jsx)(r.code,{children:"cleanBrokerData"}),"\u547d\u4ee4\u6e05\u9664Controller\u4e2d\u8be5\u7ec4Broker\u5143\u6570\u636e"]}),"\n"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsx)(r.p,{children:"\u4f7f\u7528\u4f8b\u5b50\nsh bin/mqadmin cleanBrokerData -a 127.0.0.1:9878 -b 127.0.0.1:30911 -n broker-a -c clusterName"}),"\n"]}),"\n",(0,n.jsxs)(r.ol,{start:"3",children:["\n",(0,n.jsx)(r.li,{children:"\u5220\u9664\u4e3b\u5907Broker\u4e0b\u7684\u6587\u4ef6\uff5e/store/epochFileCheckpoint\u548cepochFileCheckpoint.bak"}),"\n",(0,n.jsx)(r.li,{children:"Broker\u91cd\u65b0\u4e0a\u7ebf\uff08\u5c3d\u91cf\u4fdd\u8bc1\u65e7\u7684\u4e3b\u5907\u5173\u7cfb\uff0c\u5148\u4e3b\u540e\u5907\u4e0a\u7ebf\uff09"}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"\u5907\u6ce8",children:"\u5907\u6ce8"}),"\n",(0,n.jsx)(r.p,{children:"\u9644\u5e26\u76f8\u5173 github\u8ba8\u8bba\u5730\u5740"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://github.com/apache/rocketmq/discussions/6354",children:"https://github.com/apache/rocketmq/discussions/6354"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},7324:(e,r,a)=>{a.d(r,{A:()=>t});const t=a.p+"assets/images/NotInSyncReplica-58ce059fac42269a598516d79432afc1.png"},8453:(e,r,a)=>{a.d(r,{R:()=>c,x:()=>s});var t=a(6540);const n={},o=t.createContext(n);function c(e){const r=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:c(e.components),t.createElement(o.Provider,{value:r},e.children)}},9194:(e,r,a)=>{a.d(r,{A:()=>t});const t=a.p+"assets/images/RockeMQ-a-and-b-install-1ae3e29c3cebb1ba8ed300946ad0f655.png"}}]);