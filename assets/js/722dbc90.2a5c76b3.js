"use strict";(self.webpackChunkweihubeats_website=self.webpackChunkweihubeats_website||[]).push([[5720],{7024:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"java/juc/java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f","title":"java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f","description":"\u9700\u6c42","source":"@site/docs/java/juc/java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f.md","sourceDirName":"java/juc","slug":"/java/juc/java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f","permalink":"/docs/java/juc/java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/java/juc/java\u548cgolang\u5982\u4f55\u5b9e\u73b0\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u8bf7\u6c42\u8fd4\u56de\u7ed3\u679c\u9a6c\u4e0a\u7ed3\u675f.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u4ecespring HttpStatusCode\u6e90\u7801\u804a\u804ajdk17\u65b0\u589e\u7684sealed\u5173\u952e\u5b57","permalink":"/docs/java/jdk/jdk17/\u4ecespring HttpStatusCode\u6e90\u7801\u804a\u804ajdk17\u65b0\u589e\u7684sealed\u5173\u952e\u5b57"},"next":{"title":"\u65e0\u9501\u961f\u5217\u5b9e\u73b0(Michael-Scott \u7b97\u6cd5\u601d\u60f3)","permalink":"/docs/java/juc/\u65e0\u9501\u961f\u5217\u5b9e\u73b0(Michael-Scott \u7b97\u6cd5\u601d\u60f3)"}}');var s=e(4848),l=e(8453);const a={},o=void 0,i={},c=[{value:"\u9700\u6c42",id:"\u9700\u6c42",level:2},{value:"java",id:"java",level:2},{value:"go",id:"go",level:2}];function u(t){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,l.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u9700\u6c42",children:"\u9700\u6c42"}),"\n",(0,s.jsx)(n.p,{children:"\u6bd4\u5982\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u4e00\u4e2a\u529f\u80fd"}),"\n",(0,s.jsx)(n.p,{children:"\u5e76\u884c\u8bbf\u95ee\u591a\u4e2a\u7cfb\u7edf\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u7cfb\u7edf\u8fd4\u56de\u7ed3\u679c\uff0c\u5219\u9a6c\u4e0a\u8fd4\u56de\u6570\u636e\uff0c\u5e76\u7ed3\u675f\u5176\u4ed6\u7ed3\u679c"}),"\n",(0,s.jsx)(n.p,{children:"java\u548cgo\u5206\u522b\u5982\u4f55\u5b9e\u73b0\u5462"}),"\n",(0,s.jsx)(n.h2,{id:"java",children:"java"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'public class ParallelWebRequests {\n\n    public static void main(String[] args) throws Exception{\n\n        List<String> urls = List.of(\n                "https://httpbin.org/delay/1",  \n                "https://httpbin.org/delay/2",\n                "https://httpbin.org/delay/3"\n        );\n        \n        String result = fetchFirstResponse(urls);\n        System.out.println("First response received: " + result);\n        \n    }\n\n    private static String fetchFirstResponse(List<String> urls) throws Exception{\n        List<CompletableFuture<String>> completableFutures = urls.stream()\n                .map(url -> CompletableFuture.supplyAsync(() -> fetchUrlResponse(url)))\n                .collect(Collectors.toList());\n\n        CompletableFuture<Object> anyOfFuture = CompletableFuture.anyOf(completableFutures.toArray(new CompletableFuture[0]));\n        String res = (String) anyOfFuture.get();\n        completableFutures.forEach(future -> future.complete(res));\n        return res;\n    }\n\n    private static String fetchUrlResponse(String url) {\n        // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n        Random random = new Random();\n        String substring = url.substring(url.length() - 1);\n        try {\n            TimeUnit.SECONDS.sleep(random.nextInt(3));\n        } catch (InterruptedException e) {\n            throw new RuntimeException(e);\n        }\n        return "res " + substring;\n        \n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230java\u4f7f\u7528",(0,s.jsx)(n.code,{children:"CompletableFuture"}),"\u5b9e\u73b0\u8d77\u6765\u8fd8\u662f\u975e\u5e38\u7b80\u5355\u7684"]}),"\n",(0,s.jsx)(n.p,{children:"\u90a3\u4e48golang\u5462"}),"\n",(0,s.jsx)(n.h2,{id:"go",children:"go"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\t"io"\n\t"net/http"\n\t"sync"\n\t"time"\n)\n\nfunc main() {\n\turls := []string{\n\t\t"http://httpbin.org/delay/5", // \u5ef6\u8fdf5\u79d2\n\t\t"https://www.google.com",     // \u901a\u5e38\u5f88\u5feb\n\t\t"https://www.github.com",\n\t\t"http://httpbin.org/delay/3", // \u5ef6\u8fdf3\u79d2\n\t}\n\n\tfmt.Println("Starting concurrent fetches...")\n\tresult, err := GetFirstResponse(urls)\n\tif err != nil {\n\t\tfmt.Printf("Error: %v\\n", err)\n\t} else {\n\t\tfmt.Println("\\n--- Final Result ---")\n\t\tfmt.Println(result)\n\t}\n\n\t// \u7ed9\u4e00\u70b9\u65f6\u95f4\u8ba9\u88ab\u53d6\u6d88\u7684\u65e5\u5fd7\u6253\u5370\u51fa\u6765\n\ttime.Sleep(1 * time.Second)\n}\n\n// \u53d1\u8d77\u4e00\u4e2a\u53ef\u53d6\u6d88\u7684 HTTP GET \u8bf7\u6c42\nfunc fetchURL(ctx context.Context, url string, ch chan<- string, wg *sync.WaitGroup) {\n\tdefer wg.Done() // \u786e\u4fdd WaitGroup \u8ba1\u6570\u5668\u51cf\u5c11\n\n\t// \u521b\u5efa\u4e00\u4e2a\u4e0e\u4f20\u5165\u7684 context \u7ed1\u5b9a\u7684\u8bf7\u6c42\n\treq, err := http.NewRequestWithContext(ctx, "GET", url, nil)\n\tif err != nil {\n\t\tfmt.Printf("Error creating request for %s: %v\\n", url, err)\n\t\treturn\n\t}\n\n\tfmt.Printf("Starting fetch for: %s\\n", url)\n\tresp, err := http.DefaultClient.Do(req)\n\n\t// \u68c0\u67e5\u9519\u8bef\u3002\u5982\u679c context \u88ab\u53d6\u6d88\uff0c\u8fd9\u91cc\u4f1a\u6536\u5230\u4e00\u4e2a\u9519\u8bef\n\tif err != nil {\n\t\t// ctx.Err() \u53ef\u4ee5\u5224\u65ad\u662f\u4e0d\u662f\u7531\u4e8e context \u53d6\u6d88\u5bfc\u81f4\u7684\u9519\u8bef\n\t\tif ctx.Err() != nil {\n\t\t\tfmt.Printf("Request for %s was cancelled.\\n", url)\n\t\t} else {\n\t\t\tfmt.Printf("Error fetching %s: %v\\n", url, err)\n\t\t}\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\n\tbody, err := io.ReadAll(resp.Body)\n\tif err != nil {\n\t\tfmt.Printf("Error reading body from %s: %v\\n", url, err)\n\t\treturn\n\t}\n\n\tresult := fmt.Sprintf("Success from %s, content length: %d", url, len(body))\n\n\t// \u4f7f\u7528 select \u6765\u5c1d\u8bd5\u53d1\u9001\u7ed3\u679c\uff0c\u5982\u679c context \u5df2\u88ab\u53d6\u6d88\uff0c\u5219\u653e\u5f03\u53d1\u9001\n\tselect {\n\tcase ch <- result:\n\t\tfmt.Printf("Sent result from %s to channel.\\n", url)\n\tcase <-ctx.Done():\n\t\tfmt.Printf("Could not send result from %s because context was cancelled.\\n", url)\n\t}\n}\n\nfunc GetFirstResponse(urls []string) (string, error) {\n\tif len(urls) == 0 {\n\t\treturn "", fmt.Errorf("URL list cannot be empty")\n\t}\n\n\t// \u521b\u5efa\u4e00\u4e2a\u5e26\u53d6\u6d88\u529f\u80fd\u7684 context\n\tctx, cancel := context.WithCancel(context.Background())\n\t// \u51fd\u6570\u9000\u51fa\u65f6\uff0c\u786e\u4fdd\u8c03\u7528 cancel() \u6765\u91ca\u653e\u8d44\u6e90\n\tdefer cancel()\n\n\t// \u4f7f\u7528\u7f13\u51b2\u4e3a1\u7684channel\uff0c\u9632\u6b62\u7b2c\u4e00\u4e2agoroutine\u53d1\u9001\u65f6\u963b\u585e\n\tresultChan := make(chan string, 1)\n\tvar wg sync.WaitGroup\n\n\tfor _, url := range urls {\n\t\twg.Add(1)\n\t\tgo fetchURL(ctx, url, resultChan, &wg)\n\t}\n\n\t// \u7b49\u5f85\u7b2c\u4e00\u4e2a\u7ed3\u679c\n\tfirstResult := <-resultChan\n\tfmt.Println("First result received, cancelling other requests...")\n\n\t// \u53d6\u6d88\u5176\u4ed6\u8bf7\u6c42\n\tcancel()\n\n\t// \u7b49\u5f85\u6240\u6709goroutine\u90fd\u7ed3\u675f\uff08\u65e0\u8bba\u662f\u5b8c\u6210\u8fd8\u662f\u88ab\u53d6\u6d88\uff09\n\t// \u8fd9\u662f\u4e00\u4e2a\u597d\u7684\u5b9e\u8df5\uff0c\u786e\u4fdd\u8d44\u6e90\u88ab\u5b8c\u5168\u6e05\u7406\n\twg.Wait()\n\n\tclose(resultChan)\n\tfmt.Println("All goroutines have finished.")\n\n\treturn firstResult, nil\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["golang\u7684\u5b9e\u73b0\u4e3b\u8981\u7528\u5230\u4e86\u534f\u7a0b\u548c",(0,s.jsx)(n.code,{children:"chan"})]})]})}function d(t={}){const{wrapper:n}={...(0,l.R)(),...t.components};return n?(0,s.jsx)(n,{...t,children:(0,s.jsx)(u,{...t})}):u(t)}},8453:(t,n,e)=>{e.d(n,{R:()=>a,x:()=>o});var r=e(6540);const s={},l=r.createContext(s);function a(t){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function o(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:a(t.components),r.createElement(l.Provider,{value:n},t.children)}}}]);