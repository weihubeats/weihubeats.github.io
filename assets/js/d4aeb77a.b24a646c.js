"use strict";(self.webpackChunkweihubeats_website=self.webpackChunkweihubeats_website||[]).push([[9160],{2720:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u9650\u6d41\u7b97\u6cd5","title":"\u9650\u6d41\u7b97\u6cd5","description":"\u672c\u6587\u5c06\u5206\u6790\u5e38\u89c1\u7684\u9650\u6d41\u7b97\u6cd5\u4ee5\u53ca\u4f18\u7f3a\u70b9","source":"@site/docs/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u9650\u6d41\u7b97\u6cd5.md","sourceDirName":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5","slug":"/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u9650\u6d41\u7b97\u6cd5","permalink":"/docs/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u9650\u6d41\u7b97\u6cd5","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u9650\u6d41\u7b97\u6cd5.md","tags":[],"version":"current","frontMatter":{},"sidebar":"\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5","previous":{"title":"\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5","permalink":"/docs/\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5/\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5"}}');var s=i(4848),t=i(8453);const r={},o=void 0,a={},c=[{value:"\u56fa\u5b9a\u7a97\u53e3",id:"\u56fa\u5b9a\u7a97\u53e3",level:2},{value:"\u4ee3\u7801\u5b9e\u73b0",id:"\u4ee3\u7801\u5b9e\u73b0",level:3},{value:"\u6ed1\u52a8\u7a97\u53e3",id:"\u6ed1\u52a8\u7a97\u53e3",level:2},{value:"\u6f0f\u6876\u7b97\u6cd5",id:"\u6f0f\u6876\u7b97\u6cd5",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.p,{children:"\u672c\u6587\u5c06\u5206\u6790\u5e38\u89c1\u7684\u9650\u6d41\u7b97\u6cd5\u4ee5\u53ca\u4f18\u7f3a\u70b9"}),"\n",(0,s.jsx)(e.h2,{id:"\u56fa\u5b9a\u7a97\u53e3",children:"\u56fa\u5b9a\u7a97\u53e3"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u5185\u5b58\u5360\u7528\u5c11\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u7f3a\u70b9\uff1a\u4e34\u754c\u95ee\u9898\uff1a\u7a97\u53e3\u5207\u6362\u65f6\u53ef\u80fd\u51fa\u73b0\u7a81\u53d1\u6d41\u91cf\uff0c\u4f8b\u5982\u65f6\u95f4\u7a97\u53e3\u4e3a1\u79d2\uff0c\u524d1\u79d2\u7684\u540e500ms\u548c\u540e1\u79d2\u7684\u524d500ms\u53ef\u80fd\u5171\u540c\u901a\u8fc72 * ",(0,s.jsx)(e.code,{children:"threshold"}),"\u7684\u8bf7\u6c42."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u6837\u5b9e\u9645\u57281s\u901a\u8fc7\u4e862 * ",(0,s.jsx)(e.code,{children:"threshold"}),"\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u6ca1\u6709\u9650\u6d41\u4f4f"]}),"\n",(0,s.jsx)(e.h3,{id:"\u4ee3\u7801\u5b9e\u73b0",children:"\u4ee3\u7801\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"public class FixedWindowCounter {\n\n    /**\n     * \u9650\u6d41\u9608\u503c\n     */\n    private final int threshold;\n\n    /**\n     * \u7a97\u53e3\u65f6\u95f4(\u6beb\u79d2)\n     */\n    private final long windowMs;\n\n    /**\n     * \u4e0a\u6b21\u91cd\u7f6e\u65f6\u95f4\n     */\n    private long lastResetTime;\n\n    /**\n     * \u8ba1\u6570\u5668\n     */\n    private AtomicLong counter;\n\n    public FixedWindowCounter(long windowMs, int threshold) {\n        this.windowMs = windowMs;\n        this.threshold = threshold;\n        this.lastResetTime = System.currentTimeMillis();\n        this.counter = new AtomicLong(0);\n    }\n\n    public boolean allowRequest() {\n        long now = System.currentTimeMillis();\n        if (now > lastResetTime + windowMs) {\n            lastResetTime = now;\n            counter.set(0);\n        }\n        return counter.incrementAndGet() <= threshold;\n    }\n\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6ed1\u52a8\u7a97\u53e3",children:"\u6ed1\u52a8\u7a97\u53e3"}),"\n",(0,s.jsx)(e.p,{children:"\u6ed1\u52a8\u7a97\u53e3\u662f\u4e3a\u4e86\u89e3\u51b3\u56fa\u5b9a\u7a97\u53e3\u4e34\u754c\u7a97\u53e3\u5207\u6362\u7684\u95ee\u9898"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4f18\u70b9: \u6bd4\u56fa\u5b9a\u7a97\u53e3\u66f4\u7cbe\u51c6\uff0c\u53ef\u4ee5\u7f13\u89e3\u4e34\u754c\u95ee\u9898"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7f3a\u70b9\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5185\u5b58\u5360\u7528\u8fc7\u9ad8"}),"\n",(0,s.jsx)(e.li,{children:"\u7ec6\u7c92\u5ea6\u6ed1\u52a8\u7a97\u53e3\u5b9e\u73b0\u590d\u6742"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"public class SlidingWindow {\n\n    /**\n     * \u9650\u6d41\u9608\u503c\n     */\n    private final int threshold;\n\n    /**\n     * \u7a97\u53e3\u65f6\u95f4(\u6beb\u79d2)\n     */\n    private final long windowMs;\n\n    private ConcurrentLinkedDeque<Long> window;\n\n    public SlidingWindow(long windowMs, int threshold) {\n        this.windowMs = windowMs;\n        this.threshold = threshold;\n        this.window = new ConcurrentLinkedDeque<>();\n    }\n\n    public boolean allowRequest() {\n        long now = System.currentTimeMillis();\n\n        // \u6e05\u7406\u8fc7\u671f\u7a97\u53e3\u6570\u636e\n        while (!window.isEmpty() && now > window.peek() + windowMs) {\n            window.poll();\n        }\n        if (window.size() < threshold) {\n            window.add(now);\n            return true;\n        }\n\n        return false;\n\n    }\n\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6f0f\u6876\u7b97\u6cd5",children:"\u6f0f\u6876\u7b97\u6cd5"}),"\n",(0,s.jsx)(e.p,{children:"\u5f3a\u5236\u6052\u5b9a\u901f\u7387\u5904\u7406\u8bf7\u6c42\uff0c\u65e0\u6cd5\u5904\u7406\u7a81\u53d1\u6d41\u91cf"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u4f18\u70b9"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u7f3a\u70b9\uff1a\u65e0\u6cd5\u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf\uff1a\u5373\u4f7f\u7cfb\u7edf\u7a7a\u95f2\uff0c\u8bf7\u6c42\u4e5f\u5fc5\u987b\u7b49\u5f85\u56fa\u5b9a\u901f\u7387"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"public class LeakyBucket {\n\n    /**\n     * \u6876\u5bb9\u91cf\n     */\n    private final long capacity;\n\n    /**\n     * \u6f0f\u6c34\u901f\u7387 (\u6beb\u79d2/\u8bf7\u6c42)\n     */\n    private final long leakRate;\n\n    /**\n     * \u5f53\u524d\u6c34\u91cf\n     */\n    private long waterLevel;\n\n    /**\n     * \u4e0a\u6b21\u6f0f\u6c34\u65f6\u95f4\n     */\n    private long lastLeakTime;\n\n    public LeakyBucket(long capacity, long leakRate) {\n        this.capacity = capacity;\n        this.leakRate = leakRate;\n        this.lastLeakTime = System.currentTimeMillis();\n    }\n\n    public synchronized boolean allowRequest() {\n        long now = System.currentTimeMillis();\n        // \u8ba1\u7b97\u6f0f\u6c34\u91cf\n        long leaked = (now - lastLeakTime) / leakRate;\n        waterLevel = Math.max(0, waterLevel - leaked);\n        lastLeakTime = now;\n        if (waterLevel < capacity) {\n            waterLevel++;\n            return true;\n        }\n        return false;\n    }\n\n}\n"})})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>r,x:()=>o});var l=i(6540);const s={},t=l.createContext(s);function r(n){const e=l.useContext(t);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),l.createElement(t.Provider,{value:e},n.children)}}}]);