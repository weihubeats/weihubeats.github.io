"use strict";(self.webpackChunkweihubeats_website=self.webpackChunkweihubeats_website||[]).push([[8723],{28453:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>l});var i=r(96540);const s={},a=i.createContext(s);function t(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),i.createElement(a.Provider,{value:e},n.children)}},40648:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236","title":"\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236","description":"\u80cc\u666f","source":"@site/docs/\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236.md","sourceDirName":"\u5b89\u5168/\u7528\u6237\u6743\u9650","slug":"/\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236","permalink":"/docs/\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4ece\u96f6\u5230\u4e00\u8bbe\u8ba1\u4e00\u5957\u591a\u79df\u6237\u6743\u9650\u63a7\u5236.md","tags":[],"version":"current","frontMatter":{},"sidebar":"\u7528\u6237\u6743\u9650","previous":{"title":"OIDC\u662f\u4ec0\u4e48\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981OIDC","permalink":"/docs/\u5b89\u5168/\u7528\u6237\u6743\u9650/OIDC\u662f\u4ec0\u4e48\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981OIDC"},"next":{"title":"\u4f7f\u7528Sa-Token\u5b9e\u73b0\u4e09\u65b9\u767b\u5165-OAuth 2.0","permalink":"/docs/\u5b89\u5168/\u7528\u6237\u6743\u9650/\u4f7f\u7528Sa-Token\u5b9e\u73b0\u4e09\u65b9\u767b\u5165-OAuth 2.0"}}');var s=r(74848),a=r(28453);const t={},l=void 0,d={},o=[{value:"\u80cc\u666f",id:"\u80cc\u666f",level:2},{value:"\u8868\u7ed3\u6784\u8bbe\u8ba1",id:"\u8868\u7ed3\u6784\u8bbe\u8ba1",level:2},{value:"\u7cfb\u7edf\u6ce8\u518c\u8868",id:"\u7cfb\u7edf\u6ce8\u518c\u8868",level:3},{value:"\u83dc\u5355/\u6309\u94ae\u6743\u9650\u8868 (\u5b9a\u4e49\u903b\u8f91\u6743\u9650\uff0c\u4e0d\u5305\u542b\u5177\u4f53URL)",id:"\u83dc\u5355\u6309\u94ae\u6743\u9650\u8868-\u5b9a\u4e49\u903b\u8f91\u6743\u9650\u4e0d\u5305\u542b\u5177\u4f53url",level:3},{value:"API \u63a5\u53e3\u8868 (\u5b9a\u4e49\u540e\u7aef\u6240\u6709\u63a5\u53e3\u8d44\u6e90)",id:"api-\u63a5\u53e3\u8868-\u5b9a\u4e49\u540e\u7aef\u6240\u6709\u63a5\u53e3\u8d44\u6e90",level:3},{value:"\u83dc\u5355-API \u7ed1\u5b9a\u8868 (\u4e00\u4e2a\u6309\u94ae -&gt; \u591a\u4e2aAPI)",id:"\u83dc\u5355-api-\u7ed1\u5b9a\u8868-\u4e00\u4e2a\u6309\u94ae---\u591a\u4e2aapi",level:3},{value:"\u89d2\u8272-\u83dc\u5355\u7ed1\u5b9a\u8868",id:"\u89d2\u8272-\u83dc\u5355\u7ed1\u5b9a\u8868",level:3},{value:"\u7528\u6237\u8868",id:"\u7528\u6237\u8868",level:3},{value:"\u89d2\u8272\u8868(\u5f52\u5c5e\u4e8e\u7279\u5b9a\u5e94\u7528)",id:"\u89d2\u8272\u8868\u5f52\u5c5e\u4e8e\u7279\u5b9a\u5e94\u7528",level:3},{value:"\u6743\u9650/\u83dc\u5355\u8868 (\u83dc\u5355\u3001\u6309\u94ae\u3001API\u7ed1\u5b9a)",id:"\u6743\u9650\u83dc\u5355\u8868-\u83dc\u5355\u6309\u94aeapi\u7ed1\u5b9a",level:3},{value:"\u7528\u6237-\u89d2\u8272\u5173\u8054\u8868",id:"\u7528\u6237-\u89d2\u8272\u5173\u8054\u8868",level:3},{value:"\u89d2\u8272-\u6743\u9650\u5173\u8054\u8868",id:"\u89d2\u8272-\u6743\u9650\u5173\u8054\u8868",level:3},{value:"java\u4ee3\u7801\u5b9e\u73b0",id:"java\u4ee3\u7801\u5b9e\u73b0",level:2},{value:"\u767b\u5165\u767b\u51fa\u63a5\u53e3\u5b9e\u73b0",id:"\u767b\u5165\u767b\u51fa\u63a5\u53e3\u5b9e\u73b0",level:3}];function c(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"\u80cc\u666f",children:"\u80cc\u666f"}),"\n",(0,s.jsx)(e.p,{children:"\u8bbe\u8ba1\u4e00\u5957\u8fd0\u884c\u591a\u7cfb\u7edf(\u79df\u6237)\u7684\u6743\u9650\u7cfb\u7edf"}),"\n",(0,s.jsx)(e.h2,{id:"\u8868\u7ed3\u6784\u8bbe\u8ba1",children:"\u8868\u7ed3\u6784\u8bbe\u8ba1"}),"\n",(0,s.jsx)(e.h3,{id:"\u7cfb\u7edf\u6ce8\u518c\u8868",children:"\u7cfb\u7edf\u6ce8\u518c\u8868"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_app` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `app_name` varchar(100) NOT NULL COMMENT '\u7cfb\u7edf\u540d\u79f0',\n  `app_code` varchar(50) NOT NULL COMMENT '\u7cfb\u7edf\u7f16\u7801 (\u5982: CRM, ERP)',\n  `status` tinyint(4) DEFAULT '1' COMMENT '\u72b6\u6001 1:\u6b63\u5e38 0:\u7981\u7528',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_app_code` (`app_code`)\n) ENGINE=InnoDB COMMENT='\u5e94\u7528\u6ce8\u518c\u8868';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u83dc\u5355\u6309\u94ae\u6743\u9650\u8868-\u5b9a\u4e49\u903b\u8f91\u6743\u9650\u4e0d\u5305\u542b\u5177\u4f53url",children:"\u83dc\u5355/\u6309\u94ae\u6743\u9650\u8868 (\u5b9a\u4e49\u903b\u8f91\u6743\u9650\uff0c\u4e0d\u5305\u542b\u5177\u4f53URL)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_menu` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `parent_id` bigint(20) DEFAULT '0',\n  `app_code` varchar(50) NOT NULL,\n  `name` varchar(50) NOT NULL COMMENT '\u83dc\u5355\u6216\u6309\u94ae\u540d\u79f0',\n  `type` tinyint(4) NOT NULL COMMENT '1:\u83dc\u5355 2:\u6309\u94ae',\n  `perm_code` varchar(100) NOT NULL COMMENT '\u6743\u9650\u6807\u8bc6 (\u5982: user:add)',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_perm` (`perm_code`)\n) COMMENT='\u524d\u7aef\u8d44\u6e90(\u83dc\u5355/\u6309\u94ae)';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"api-\u63a5\u53e3\u8868-\u5b9a\u4e49\u540e\u7aef\u6240\u6709\u63a5\u53e3\u8d44\u6e90",children:"API \u63a5\u53e3\u8868 (\u5b9a\u4e49\u540e\u7aef\u6240\u6709\u63a5\u53e3\u8d44\u6e90)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_api` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `app_code` varchar(50) NOT NULL,\n  `path` varchar(200) NOT NULL COMMENT '\u63a5\u53e3\u8def\u5f84 (\u5982: /api/user/**)',\n  `method` varchar(10) DEFAULT 'ALL' COMMENT '\u8bf7\u6c42\u65b9\u5f0f: GET, POST, PUT, DELETE, ALL',\n  `name` varchar(100) DEFAULT NULL COMMENT '\u63a5\u53e3\u63cf\u8ff0',\n  PRIMARY KEY (`id`)\n) COMMENT='\u540e\u7aefAPI\u63a5\u53e3';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u83dc\u5355-api-\u7ed1\u5b9a\u8868-\u4e00\u4e2a\u6309\u94ae---\u591a\u4e2aapi",children:"\u83dc\u5355-API \u7ed1\u5b9a\u8868 (\u4e00\u4e2a\u6309\u94ae -> \u591a\u4e2aAPI)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_menu_api` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `menu_id` bigint(20) NOT NULL COMMENT '\u5173\u8054sys_menu.id',\n  `api_id` bigint(20) NOT NULL COMMENT '\u5173\u8054sys_api.id',\n  PRIMARY KEY (`id`)\n) COMMENT='\u6743\u9650\u4e0eAPI\u7684\u7ed1\u5b9a\u5173\u7cfb';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u89d2\u8272-\u83dc\u5355\u7ed1\u5b9a\u8868",children:"\u89d2\u8272-\u83dc\u5355\u7ed1\u5b9a\u8868"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_role_menu` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `role_id` bigint(20) NOT NULL,\n  `menu_id` bigint(20) NOT NULL,\n  PRIMARY KEY (`id`)\n);\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u7528\u6237\u8868",children:"\u7528\u6237\u8868"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"sys_user"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_user` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `username` varchar(50) NOT NULL COMMENT '\u8d26\u53f7',\n  `password` varchar(100) NOT NULL COMMENT '\u52a0\u5bc6\u5bc6\u7801',\n  `real_name` varchar(50) DEFAULT NULL COMMENT '\u771f\u5b9e\u59d3\u540d',\n  `status` tinyint(4) DEFAULT '1' COMMENT '\u72b6\u6001 1:\u6b63\u5e38 0:\u7981\u7528',\n  `create_time` datetime DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_username` (`username`)\n) ENGINE=InnoDB COMMENT='\u7528\u6237\u8868';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u89d2\u8272\u8868\u5f52\u5c5e\u4e8e\u7279\u5b9a\u5e94\u7528",children:"\u89d2\u8272\u8868(\u5f52\u5c5e\u4e8e\u7279\u5b9a\u5e94\u7528)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"sys_role"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_role` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `app_code` varchar(50) NOT NULL COMMENT '\u5f52\u5c5e\u5e94\u7528\u7f16\u7801',\n  `role_name` varchar(50) NOT NULL COMMENT '\u89d2\u8272\u540d\u79f0',\n  `role_code` varchar(50) NOT NULL COMMENT '\u89d2\u8272\u6807\u8bc6 (\u5982: admin, user)',\n  `status` tinyint(4) DEFAULT '1',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB COMMENT='\u89d2\u8272\u8868';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6743\u9650\u83dc\u5355\u8868-\u83dc\u5355\u6309\u94aeapi\u7ed1\u5b9a",children:"\u6743\u9650/\u83dc\u5355\u8868 (\u83dc\u5355\u3001\u6309\u94ae\u3001API\u7ed1\u5b9a)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_permission` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `parent_id` bigint(20) DEFAULT '0' COMMENT '\u7236ID',\n  `app_code` varchar(50) NOT NULL COMMENT '\u5f52\u5c5e\u5e94\u7528\u7f16\u7801',\n  `name` varchar(50) NOT NULL COMMENT '\u540d\u79f0 (\u5982: \u7528\u6237\u7ba1\u7406, \u65b0\u589e\u7528\u6237)',\n  `type` tinyint(4) NOT NULL COMMENT '\u7c7b\u578b 1:\u76ee\u5f55 2:\u83dc\u5355 3:\u6309\u94ae/API',\n  `perms` varchar(100) DEFAULT NULL COMMENT '\u6743\u9650\u6807\u8bc6 (\u5982: sys:user:add)',\n  `api_path` varchar(200) DEFAULT NULL COMMENT '\u540e\u7aef\u63a5\u53e3\u8def\u5f84 (\u53ef\u9009\uff0c\u7528\u4e8e\u7f51\u5173\u9274\u6743)',\n  `route_path` varchar(200) DEFAULT NULL COMMENT '\u524d\u7aef\u8def\u7531\u8def\u5f84',\n  `order_num` int(11) DEFAULT '0' COMMENT '\u6392\u5e8f',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB COMMENT='\u6743\u9650\u8d44\u6e90\u8868';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u7528\u6237-\u89d2\u8272\u5173\u8054\u8868",children:"\u7528\u6237-\u89d2\u8272\u5173\u8054\u8868"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_user_role` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `user_id` bigint(20) NOT NULL,\n  `role_id` bigint(20) NOT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `uk_user_role` (`user_id`,`role_id`)\n) ENGINE=InnoDB COMMENT='\u7528\u6237\u89d2\u8272\u5173\u8054\u8868';\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u89d2\u8272-\u6743\u9650\u5173\u8054\u8868",children:"\u89d2\u8272-\u6743\u9650\u5173\u8054\u8868"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE `sys_role_permission` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `role_id` bigint(20) NOT NULL,\n  `permission_id` bigint(20) NOT NULL,\n  PRIMARY KEY (`id`),\n  KEY `idx_role_id` (`role_id`)\n) ENGINE=InnoDB COMMENT='\u89d2\u8272\u6743\u9650\u5173\u8054\u8868';\n"})}),"\n",(0,s.jsx)(e.h2,{id:"java\u4ee3\u7801\u5b9e\u73b0",children:"java\u4ee3\u7801\u5b9e\u73b0"}),"\n",(0,s.jsxs)(e.p,{children:["\u6846\u67b6\u4e3b\u8981\u662f",(0,s.jsx)(e.code,{children:"Spring Boot"})," + ",(0,s.jsx)(e.code,{children:"Sa-Token"})," + ",(0,s.jsx)(e.code,{children:"MyBatis Plus"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:"<dependency>\n    <groupId>cn.dev33</groupId>\n    <artifactId>sa-token-spring-boot3-starter</artifactId>\n    <version>1.37.0</version>\n</dependency>\n\n<dependency>\n    <groupId>com.baomidou</groupId>\n    <artifactId>mybatis-plus-spring-boot3-starter</artifactId>\n    <version>3.5.5</version>\n</dependency>\n\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u81ea\u5b9a\u4e49\u6743\u9650\u52a0\u8f7d\u63a5\u53e3 (StpInterface)"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:"package com.example.auth.service;\n\nimport cn.dev33.satoken.stp.StpInterface;\nimport com.example.auth.mapper.SysUserMapper;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Component;\n\nimport java.util.List;\n\n/**\n * \u81ea\u5b9a\u4e49\u6743\u9650\u9a8c\u8bc1\u63a5\u53e3\u6269\u5c55\n */\n@Component\npublic class StpInterfaceImpl implements StpInterface {\n\n    @Autowired\n    private SysUserMapper sysUserMapper;\n\n    /**\n     * \u8fd4\u56de\u4e00\u4e2a\u8d26\u53f7\u6240\u62e5\u6709\u7684\u6743\u9650\u7801\u96c6\u5408\n     */\n    @Override\n    public List<String> getPermissionList(Object loginId, String loginType) {\n        // loginId \u5373\u4e3a User ID\n        Long userId = Long.valueOf(loginId.toString());\n        \n        // \u7f16\u5199 SQL: \n        // select distinct p.perms from sys_permission p\n        // left join sys_role_permission rp on p.id = rp.permission_id\n        // left join sys_user_role ur on rp.role_id = ur.role_id\n        // where ur.user_id = ? and p.perms is not null\n        return sysUserMapper.selectPermsByUserId(userId);\n    }\n\n    /**\n     * \u8fd4\u56de\u4e00\u4e2a\u8d26\u53f7\u6240\u62e5\u6709\u7684\u89d2\u8272\u6807\u8bc6\u96c6\u5408 (\u6743\u9650\u4e0e\u89d2\u8272\u53ef\u5206\u79bb)\n     */\n    @Override\n    public List<String> getRoleList(Object loginId, String loginType) {\n        Long userId = Long.valueOf(loginId.toString());\n        // select distinct r.role_code from sys_role r ...\n        return sysUserMapper.selectRoleCodesByUserId(userId);\n    }\n}\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-xml",children:'<select id="selectPermsByUserId" resultType="java.lang.String">\n    SELECT DISTINCT p.perms\n    FROM sys_permission p\n    INNER JOIN sys_role_permission rp ON p.id = rp.permission_id\n    INNER JOIN sys_user_role ur ON rp.role_id = ur.role_id\n    WHERE ur.user_id = #{userId}\n    AND p.status = 1\n    AND p.perms IS NOT NULL\n    AND p.perms != \'\'\n</select>\n'})}),"\n",(0,s.jsx)(e.h3,{id:"\u767b\u5165\u767b\u51fa\u63a5\u53e3\u5b9e\u73b0",children:"\u767b\u5165\u767b\u51fa\u63a5\u53e3\u5b9e\u73b0"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-java",children:'\n@RestController\n@RequestMapping("/auth")\npublic class AuthController {\n\n    @Autowired\n    private SysUserService userService;\n\n    @PostMapping("/login")\n    public SaResult login(@RequestBody LoginDto loginDto) {\n        // 1. \u6821\u9a8c\u8d26\u53f7\u5bc6\u7801 (\u4f2a\u4ee3\u7801)\n        SysUser user = userService.getByUsername(loginDto.getUsername());\n        if(user == null || !checkPwd(loginDto.getPassword(), user.getPassword())) {\n            return SaResult.error("\u8d26\u53f7\u6216\u5bc6\u7801\u9519\u8bef");\n        }\n\n        // 2. \u767b\u5f55 (Sa-Token \u4f1a\u81ea\u52a8\u751f\u6210 Token \u5e76\u6ce8\u5165 Cookie/Header)\n        StpUtil.login(user.getId());\n        \n        // 3. \u8fd4\u56de Token \u4fe1\u606f\u7ed9\u524d\u7aef\n        SaTokenInfo tokenInfo = StpUtil.getTokenInfo();\n        return SaResult.data(tokenInfo);\n    }\n    \n    @RequestMapping("/logout")\n    public SaResult logout() {\n        StpUtil.logout();\n        return SaResult.ok();\n    }\n}\n\n'})})]})}function p(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}}}]);