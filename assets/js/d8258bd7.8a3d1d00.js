"use strict";(self.webpackChunkweihubeats_website=self.webpackChunkweihubeats_website||[]).push([[8893],{38:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rocketmq-store-file-fd6e7eddad93016054719105b81a4fa5.png"},308:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/comparing-random-and-sequential-access-4664c26295ebce69fd74388ae74a9e53.png"},1443:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/topic-file-f67dcf103cc923f8e000bb808becd7d2.png"},2370:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/checkMessageAndReturnSize-code-e0228ac7241b17419851a689e5d2f588.png"},2619:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/index-image-05858b20455029116074db08a837499b.png"},5749:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>s,toc:()=>x});const s=JSON.parse('{"id":"MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b","title":"\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b","description":"\u8fd9\u91cc\u662fweihubeats,\u89c9\u5f97\u6587\u7ae0\u4e0d\u9519\u53ef\u4ee5\u5173\u6ce8\u516c\u4f17\u53f7\u5c0f\u594f\u6280\u672f","source":"@site/docs/MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b.md","sourceDirName":"MQ/RocketMQ/\u6e90\u7801\u5206\u6790","slug":"/MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b","permalink":"/docs/MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4ece\u9762\u5230\u70b9\u4fef\u77b0RocketMQ\u5b58\u50a8\u6a21\u578b.md","tags":[],"version":"current","frontMatter":{},"sidebar":"RocketMQ","previous":{"title":"\u4e00\u4e9b\u6bd4\u8f83\u6709\u610f\u601d\u7684PR","permalink":"/docs/MQ/RocketMQ/\u6e90\u7801\u5206\u6790/\u4e00\u4e9b\u6bd4\u8f83\u6709\u610f\u601d\u7684PR"},"next":{"title":"RocketMQ\u5982\u4f55\u6dfb\u52a0JVM\u76d1\u63a7","permalink":"/docs/MQ/RocketMQ/\u76d1\u63a7/RocketMQ\u5982\u4f55\u6dfb\u52a0JVM\u76d1\u63a7"}}');var l=n(4848),c=n(8453);const i={},d=void 0,r={},x=[{value:"RocketMQ version",id:"rocketmq-version",level:2},{value:"\u8111\u56fe\u603b\u89c8",id:"\u8111\u56fe\u603b\u89c8",level:2},{value:"\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6",id:"\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6",level:2},{value:"\u6d88\u606f\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6 commitLog",id:"\u6d88\u606f\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6-commitlog",level:2},{value:"consumequeue",id:"consumequeue",level:2},{value:"\u7d22\u5f15\u6587\u4ef6 IndexFile",id:"\u7d22\u5f15\u6587\u4ef6-indexfile",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2},{value:"\u53c2\u8003",id:"\u53c2\u8003",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:["\u8fd9\u91cc\u662f",(0,l.jsx)(t.strong,{children:"weihubeats"}),",\u89c9\u5f97\u6587\u7ae0\u4e0d\u9519\u53ef\u4ee5\u5173\u6ce8\u516c\u4f17\u53f7",(0,l.jsx)(t.strong,{children:"\u5c0f\u594f\u6280\u672f"})]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"rocketmq-version",children:"RocketMQ version"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"5.1.0"}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"\u8111\u56fe\u603b\u89c8",children:"\u8111\u56fe\u603b\u89c8"}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(6569).A+"",width:"1067",height:"1237"})}),"\n",(0,l.jsx)(t.h2,{id:"\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6",children:"\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6"}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(38).A+"",width:"946",height:"301"})}),"\n",(0,l.jsx)(t.h2,{id:"\u6d88\u606f\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6-commitlog",children:"\u6d88\u606f\u5b9e\u9645\u5b58\u50a8\u6587\u4ef6 commitLog"}),"\n",(0,l.jsxs)(t.p,{children:["\u6d88\u606f\u5b9e\u9645\u662f\u5b58\u50a8\u5728",(0,l.jsx)(t.code,{children:"commitLog"}),"\u91cc\u9762.\u91cc\u9762\u6ca1\u6709\u533a\u5206",(0,l.jsx)(t.code,{children:"topic"}),"\u548c",(0,l.jsx)(t.code,{children:"queue"})]}),"\n",(0,l.jsx)(t.p,{children:"\u5b58\u50a8\u7ed3\u6784\u7684\u5b9a\u4e49\u5982\u4e0b\u8868"}),"\n",(0,l.jsx)(t.p,{children:"\u6d88\u606f\u7684\u5177\u4f53\u683c\u5f0f\u5b9a\u4e49"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"\u7b2c\u51e0\u4f4d"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"\u5b57\u6bb5"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"\u6570\u636e\u7c7b\u578b"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"\u957f\u5ea6(\u5b57\u8282)"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"\u8bf4\u660e"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"1"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"totalSize"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u603b\u957f\u5ea6"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"2"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"magicCode"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u9b54\u672f"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"3"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"bodyCRC"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u4f53CRC\u6821\u9a8c\u7801"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"queueId"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u961f\u5217id"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"5"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"flag"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u6807\u8bb0.RocketMQ\u4e0d\u5bf9\u5176\u505a\u4efb\u4f55\u5904\u7406.\u5e94\u7528\u7a0b\u5e8f\u53ef\u4f7f\u7528"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"6"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"queueOffset"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u5728ConusmeQueue\u4e2d\u7684\u7269\u7406\u504f\u79fb\u91cf"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"7"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"physicOffset"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u5728CommitLog\u6587\u4ef6\u4e2d\u7684\u7269\u7406\u504f\u79fb\u91cf"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"sysFlag"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u7cfb\u7edf\u6807\u8bc6\uff0c\u6bd4\u5982\u662f\u5426\u538b\u7f29\uff0c\u662f\u5426\u662f\u4e8b\u52a1\u6d88\u606f\u7b49"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"9"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"bornTimeStamp"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u53d1\u9001\u65f6\u95f4\u6233"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"10"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"BORNHOST"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8(20)"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u53d1\u9001\u8005ip\u3001\u7aef\u53e3\u3002v6 8\u5b57\u8282\uff0c\u5426\u521920\u5b57\u8282"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"11"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"storeTimestamp"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u5b58\u50a8\u65f6\u95f4\u6233"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"12"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"STOREHOSTADDRESS"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8(20)"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"broker ip+\u7aef\u53e3,v6 8\u5b57\u8282\uff0c\u5426\u521920\u5b57\u8282"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"13"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"reconsumeTimes"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u91cd\u8bd5\u6b21\u6570\uff0c4\u5b57\u8282"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"14"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"preparedTransactionOffset"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"long"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"8"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u4e8b\u52a1\u6d88\u606f\u7269\u7406\u504f\u79fb\u91cf"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"15"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"bodyLen"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"int"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"4"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u957f\u5ea6"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"16"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"body"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"bodyLen"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606fbody\uff0c\u957f\u5ea6\u4e3abodyLen"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"17"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"TopicLength"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"1(2)"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"topic\u957f\u5ea6,V1\u7248\u672c\u662f1\u5b57\u8282\uff0cV2\u662f2\u5b57\u8282"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"18"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"topic"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"TopicLength\u7684\u503c"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"topic name"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"19"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"propertiesLength"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"short"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"2"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u5c5e\u6027\u957f\u5ea6"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"20"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"properties"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"~"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"propertiesLength\u7684\u503c"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u6d88\u606f\u5c5e\u6027(\u91cc\u9762\u5305\u542bkey\u3001uniqKye\u3001tags\u3001delayLevel\u7b49)"})]})]})]}),"\n",(0,l.jsxs)(t.p,{children:["\u8fd9\u91cc\u7684\u5b57\u6bb5\u6211\u4eec\u662f\u7ed3\u5408\u6e90\u7801",(0,l.jsx)(t.code,{children:"org.apache.rocketmq.store.CommitLog#checkMessageAndReturnSize(java.nio.ByteBuffer, boolean, boolean, boolean)"}),"\u603b\u7ed3\u51fa\u6765\u7684"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(2370).A+"",width:"1852",height:"1276"})}),"\n",(0,l.jsx)(t.p,{children:"\u4e5f\u53ef\u4ee5\u81ea\u5df1\u770b\u6e90\u7801"}),"\n",(0,l.jsxs)(t.p,{children:["\u6587\u4ef6\u540d\u9ed8\u8ba4\u503c\u662f20\u4e2a\u5b57\u7b26\uff0c\u6587\u4ef6\u540d\u5c31\u662f\u8d77\u59cb\u7684\u504f\u79fb\u91cf\uff0c\u4e0d\u591f\u7684\u8865\u96f6\uff0c\u6bd4\u5982\u7b2c\u4e00\u4e2a\u6587\u4ef6\u7684\u8d77\u59cb\u504f\u79fb\u91cf\u662f0\u7136\u540e\u4ece",(0,l.jsx)(t.code,{children:"00000000000000000000"}),"\u5f00\u59cb\uff0c\u6bcf\u4e2a\u6587\u4ef6\u9ed8\u8ba41G(1024 * 1024 * 1024=1073741824 \u5b57\u8282)\uff0c\u4e0b\u4e2a\u6587\u4ef6\u540d\u5c31\u662f",(0,l.jsx)(t.code,{children:"00000000001073741824"})]}),"\n",(0,l.jsx)(t.p,{children:"\u8fd9\u6837\u8bbe\u8ba1\u7684\u597d\u5904"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"\u987a\u5e8f\u5199\u5165\uff1a\u9ad8\u6027\u80fd\uff0c\u78c1\u76d8\u7684\u987a\u5e8f\u5199\u5165\u6027\u80fd\u6bd4\u5185\u5b58\u7684\u968f\u673a\u5199\u5165\u8fd8\u8981\u9ad8"}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(308).A+"",width:"2182",height:"1182"})}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:["\u78c1\u76d8\u5199\u5165\u6027\u80fd\u6bd4\u5bf9\u5177\u4f53\u53ef\u4ee5\u53c2\u8003 ",(0,l.jsx)(t.a,{href:"https://queue.acm.org/detail.cfm?id=1563874",children:"The Pathologies of Big Data"})]}),"\n"]}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["\u67e5\u627e\u6027\u80fd\u9ad8:\u7531\u4e8e\u662f\u987a\u5e8f\u5199\u5165\uff0c\u6587\u4ef6\u540d\u4e5f\u662f\u987a\u5e8f\u7684\u3002\n\u6240\u4ee5\u5982\u679c\u6709\u4efb\u4f55\u4e00\u4e2a\u7269\u7406\u504f\u79fb\u91cf\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u4e8c\u5206\u67e5\u627eO(log n)\u5f88\u5feb\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684",(0,l.jsx)(t.code,{children:"CommitLog"}),"\uff0c\u5b9a\u4f4d\u5230\u6587\u4ef6\u540e\u4f7f\u7528",(0,l.jsx)(t.strong,{children:"\u7269\u7406\u504f\u79fb\u91cf -\u6587\u4ef6\u540d"}),"\uff0c\u5c31\u662f\u5728",(0,l.jsx)(t.strong,{children:"\u6587\u4ef6\u4e2d\u7684\u7269\u7406\u504f\u79fb\u91cf"})]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"consumequeue",children:"consumequeue"}),"\n",(0,l.jsx)(t.p,{children:"RocketMQ\u6d88\u606f\u6d88\u8d39\u6a21\u578b\u662f"}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"consumer"})," \u8ba2\u9605 ",(0,l.jsx)(t.code,{children:"topic"}),",",(0,l.jsx)(t.code,{children:"topic"}),"\u91cc\u9762\u6709",(0,l.jsx)(t.code,{children:"queue"})]}),"\n",(0,l.jsxs)(t.p,{children:["\u6240\u4ee5\u5b9e\u9645",(0,l.jsx)(t.code,{children:"consumer"}),"\u5e76\u4e0d\u76f4\u63a5\u4e0e",(0,l.jsx)(t.code,{children:"commitLog"}),"\u6253\u4ea4\u9053\uff0c\u4e3b\u8981\u662f\u548c",(0,l.jsx)(t.code,{children:"queue"}),"\u6253\u4ea4\u9053\n",(0,l.jsx)(t.code,{children:"queue"}),"\u7684\u5b9e\u9645\u7269\u7406\u5b58\u50a8\u8def\u5f84\u5c31\u662f"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.code,{children:"consumequeue/${topicName}/1/00000000000000000000"})}),"\n",(0,l.jsx)(t.p,{children:"\u6bd4\u5982\u8fd9\u6837\u7684"}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(1443).A+"",width:"1320",height:"194"})}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"consumequeue"}),"\u7684\u5b9e\u9645\u5b58\u50a8\u7ed3\u6784\u5c31\u662f\u5982\u4e0b\u7684"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(9399).A+"",width:"1978",height:"151"})}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"\u6e90\u7801\u4e2d\u7684\u4f53\u73b0"}),"\n"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(7920).A+"",width:"1909",height:"469"})}),"\n",(0,l.jsxs)(t.p,{children:["\u4e00\u6761\u6d88\u606f\u5b57\u8282\u4e3a ",(0,l.jsx)(t.code,{children:"8 + 4 + 8 = 20"}),",\u4e00\u4e2a\u6587\u4ef630w\u4e2a\u3002\n\u6240\u4ee5\u4e00\u4e2a",(0,l.jsx)(t.code,{children:"consumequeue"}),"\u6587\u4ef6\u662f ",(0,l.jsx)(t.code,{children:"300000 * 20 / 1024 / 1024 = 5.72M"})]}),"\n",(0,l.jsxs)(t.p,{children:["\u6d88\u8d39\u8005\u5728\u8ba2\u9605\u6d88\u606f\u7684\u65f6\u5019\u4e0d\u9700\u8981\u904d\u5386",(0,l.jsx)(t.code,{children:"commitLog"}),"\u6574\u4e2a\u6587\u4ef6\uff0c\u53ea\u9700\u8981\u904d\u5386",(0,l.jsx)(t.code,{children:"consumequeue"}),",",(0,l.jsx)(t.code,{children:"consumequeue"}),"\u4e2d\u5b58\u50a8\u6d88\u606f\u7684\u504f\u79fb\u91cf\u548c\u5927\u5c0f\u3002\u7136\u540e\u53bb",(0,l.jsx)(t.code,{children:"commitLog"}),"\u4e8c\u5206\u627e\u5230\u6d88\u606f\u5373\u53ef\u3002"]}),"\n",(0,l.jsx)(t.p,{children:"\u5982\u679c\u8981\u57fa\u4e8e\u6d88\u606f\u7684tag\u8fc7\u6ee4\uff0c\u4e5f\u662f\u901a\u8fc7tag\u7684hash\u8fdb\u884c\u8fc7\u6ee4"}),"\n",(0,l.jsx)(t.h2,{id:"\u7d22\u5f15\u6587\u4ef6-indexfile",children:"\u7d22\u5f15\u6587\u4ef6 IndexFile"}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"RocketMQ"}),"\u5982\u679c\u901a\u8fc7\u6d88\u606fid\uff08offsetMsgId\uff09\u53bb\u67e5\u627e\u6d88\u606f\u662f\u975e\u5e38\u5bb9\u6613\u7684\uff0c\u56e0\u4e3a\u6d88\u606fid(offsetMsgId)\u672c\u8eab\u5c31\u662f\u7531",(0,l.jsx)(t.code,{children:"broker IP"})," + ",(0,l.jsx)(t.code,{children:"broker port"})," + ",(0,l.jsx)(t.code,{children:"\u6d88\u606f\u7684\u7269\u7406\u504f\u79fb\u91cf"})]}),"\n",(0,l.jsxs)(t.p,{children:["\u4f46\u662f\u5982\u679c\u8981\u57fa\u4e8e\u6bd4\u5982\u6211\u4eec\u8bbe\u7f6e\u7684",(0,l.jsx)(t.code,{children:"message key"}),"\u53bb\u6216\u8005",(0,l.jsx)(t.code,{children:"UNIQ_KEY"}),"\u67e5\u8be2\u3002\u5f88\u660e\u663e\u4e0a\u9762\u7684\u5b58\u50a8\u7ed3\u6784\u5c31\u4e0d\u652f\u6301\u4e86\u3002"]}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsxs)(t.p,{children:["\u4e0d\u6e05\u695a ",(0,l.jsx)(t.code,{children:"UNIQ_KEY"}),"\u548c",(0,l.jsx)(t.code,{children:"offsetMsgId"}),"\u7684\u533a\u522b\u53ef\u4ee5\u770b\u4e4b\u524d\u7684\u535a\u6587"]}),"\n"]}),"\n",(0,l.jsxs)(t.blockquote,{children:["\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.a,{href:"https://weihubeats.blog.csdn.net/article/details/130495965",children:"https://weihubeats.blog.csdn.net/article/details/130495965"})}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["\u6240\u4ee5\u6211\u4eec\u9700\u8981\u518d\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6\uff0c\u7528\u6765\u652f\u6301\u6309",(0,l.jsx)(t.code,{children:"message key"}),"\u67e5\u8be2\u6d88\u606f"]}),"\n",(0,l.jsxs)(t.p,{children:[(0,l.jsx)(t.code,{children:"IndexFile"}),"\u5b9e\u9645\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a"]}),"\n",(0,l.jsx)(t.p,{children:(0,l.jsx)(t.img,{alt:"alt text",src:n(2619).A+"",width:"1656",height:"609"})}),"\n",(0,l.jsx)(t.p,{children:"\u5bfb\u627e\u65b9\u5f0f\u5c31\u662f"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsx)(t.li,{children:"\u6839\u636e key \u7684 Hash \u503c\u8ba1\u7b97\u51fa hash\u69fd\u7edd\u5bf9\u4f4d\u7f6e absSlotPos"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"int keyHash = indexKeyHashMethod(key);\nint slotPos = keyHash % this.hashSlotNum;\nint absSlotPos = IndexHeader.INDEX_HEADER_SIZE + slotPos * hashSlotSize;\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsx)(t.li,{children:"\u83b7\u53d6\u5f53\u524d hash\u69fd\u7684\u503c\uff0c\u4e3a\u8be5 hash\u69fd\u5bf9\u5e94\u7684\u6700\u65b0\u7684\u7d22\u5f15\u7684\u903b\u8f91\u4e0b\u6807"}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-java",children:"int slotValue = this.mappedByteBuffer.getInt(absSlotPos);\n"})}),"\n",(0,l.jsxs)(t.ol,{start:"3",children:["\n",(0,l.jsx)(t.li,{children:"\u627e\u5230index item"}),"\n"]}),"\n",(0,l.jsxs)(t.p,{children:["\u5177\u4f53\u7684\u4ee3\u7801\u6e90\u7801\u53ef\u4ee5\u53c2\u8003",(0,l.jsx)(t.code,{children:"org.apache.rocketmq.store.index.IndexService#queryOffset"})]}),"\n",(0,l.jsxs)(t.ol,{start:"4",children:["\n",(0,l.jsxs)(t.li,{children:["\u57fa\u4e8eindex item\u627e\u5230\u5bf9\u5e94\u7684",(0,l.jsx)(t.code,{children:"commitLog"})]}),"\n"]}),"\n",(0,l.jsx)(t.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,l.jsxs)(t.p,{children:["RocketMQ\u7684\u6d88\u606f\u6587\u4ef6\u4e3b\u8981\u5b58\u50a8\u5728",(0,l.jsx)(t.code,{children:"commitLog"}),"\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u9ad8\u6027\u80fd\u7684\u8bfb\u5199\uff0c",(0,l.jsx)(t.code,{children:"commitLog"}),"\u91c7\u7528\u987a\u5e8f\u5199\u5165\uff0c\u6587\u4ef6\u540d\u6309\u504f\u79fb\u91cf\u547d\u540d\uff0c\u8fd9\u6837\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u6d88\u606f\u7684\u6548\u7387\u975e\u5e38\u9ad8\u3002"]}),"\n",(0,l.jsxs)(t.p,{children:["\u7531\u4e8e\u8ba2\u9605\u6a21\u578b\u662f\u57fa\u4e8e",(0,l.jsx)(t.code,{children:"topic"}),"\u7684\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\u53c8\u5f15\u5165\u4e86",(0,l.jsx)(t.code,{children:"consumequeue"}),",",(0,l.jsx)(t.code,{children:"consumequeue"}),"\u7c7b\u4f3c",(0,l.jsx)(t.code,{children:"commitLog"}),"\u7684\u7d22\u5f15\uff0c\u5e76\u4e0d\u4f1a\u76f4\u63a5\u5b58\u50a8\u6d88\u606f\uff0c\u53ea\u5b58\u50a8\u4e86\u6d88\u606f\u7684\u7269\u7406\u504f\u79fb\u91cf\uff0c\u8fd9\u6837\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u901a\u8fc7",(0,l.jsx)(t.code,{children:"consumequeue"}),"\u5b9a\u4f4d\u5230",(0,l.jsx)(t.code,{children:"commitLog"})]}),"\n",(0,l.jsxs)(t.p,{children:["\u4e3a\u4e86\u652f\u6301\u6309",(0,l.jsx)(t.code,{children:"key"}),"\u67e5\u627e\uff0c",(0,l.jsx)(t.code,{children:"RocketMQ"}),"\u53c8\u5f15\u5165\u4e86\u7d22\u5f15\u6587\u4ef6",(0,l.jsx)(t.code,{children:"IndexFile"}),"\uff0c\u7528\u6765\u652f\u6301\u6309key\u7684\u67e5\u8be2\u3002\u7d22\u5f15\u6587\u4ef6\u4e3b\u8981\u662f\u5229\u7528hash\uff0c\u901a\u8fc7\u5bf9",(0,l.jsx)(t.code,{children:"topic + key"}),"\u8fdb\u884chash\uff0c\u7136\u540e\u5b58\u50a8\u5bf9\u5e94\u7684\u6d88\u606f\u7269\u7406\u504f\u79fb\u91cf."]}),"\n",(0,l.jsxs)(t.p,{children:["RocketMQ\u6838\u5fc3\u7684\u6d88\u606f\u5b58\u50a8\u6587\u4ef6\u5c31\u662f",(0,l.jsx)(t.code,{children:"commitLog"}),"\uff0c\u5176\u4ed6\u6587\u4ef6\u90fd\u662f\u4e3a\u4e86\u63d0\u5347\u6548\u7387\u5f15\u5165\u7684\uff0c\u90fd\u53ef\u4ee5\u7406\u89e3\u4e3a\u662f\u7d22\u5f15\u6587\u4ef6"]}),"\n",(0,l.jsx)(t.h2,{id:"\u53c2\u8003",children:"\u53c2\u8003"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"https://github.com/apache/rocketmq",children:"https://github.com/apache/rocketmq"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"https://rocketmq.apache.org/zh/",children:"https://rocketmq.apache.org/zh/"})}),"\n",(0,l.jsx)(t.li,{children:(0,l.jsx)(t.a,{href:"https://queue.acm.org/detail.cfm?id=1563874",children:"https://queue.acm.org/detail.cfm?id=1563874"})}),"\n"]})]})}function o(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},6569:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/rocketmq-store-mind-map-646d8f9e1ebf3db72bff8147933f6a2a.png"},7920:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/consumequeue-code-9298fcb2be7fb33a1f410360a299c22d.png"},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>d});var s=n(6540);const l={},c=s.createContext(l);function i(e){const t=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(c.Provider,{value:t},e.children)}},9399:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/consume-queue-b8a1bceca003f1f7fb8a1f81692ab6bf.png"}}]);